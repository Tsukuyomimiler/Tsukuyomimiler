name: guild-workflow

on:
  schedule:
    - cron: "0 0 * * *"   # Atualiza todo dia Ã  meia-noite
  workflow_dispatch:

jobs:
  metrics:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: ğŸ“¦ Gerar perfil lowlighter
        uses: lowlighter/metrics@latest
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          user: lowlighter
          config_timezone: America/Sao_Paulo
          filename: github-metrics.svg

          base: header, activity, community, repositories
          plugin_isocalendar: yes
          plugin_followup: yes
          plugin_stars: yes
          plugin_topics: yes
          plugin_languages: yes
          plugin_achievements: yes
          plugin_contributors: yes
          plugin_discussions: yes
          plugin_contributions: yes

          # ğŸ–¼ï¸ CustomizaÃ§Ã£o do cartÃ£o
          plugin_languages_limit: 3
          plugin_languages_ignored: html, css, shell, go, rust, php
          plugin_languages_sections: most-used
          plugin_languages_colors: "#f1e05a,#3572A5,#701516"
          plugin_achievements_threshold: C
          plugin_achievements_display: compact

      - name: ğŸ¨ Gerar CartÃ£o da Guilda
        run: |
          mkdir -p guild
          USER="lowlighter"
          AVATAR=$(curl -s "https://api.github.com/users/$USER" | jq -r '.avatar_url')
          DATE=$(date +'%d/%m/%Y')
          cat <<EOF > guild/lowlighter-guild.svg
<svg xmlns="http://www.w3.org/2000/svg" width="460" height="300">
  <rect width="460" height="300" rx="15" fill="#fdf6e3" stroke="#8B4513" stroke-width="3"/>
  <image href="${AVATAR}" x="20" y="40" width="90" height="90" clip-path="circle(45px at 45px 45px)"/>
  <text x="130" y="70" font-size="20" font-weight="bold">lowlighter</text>
  <text x="130" y="95" font-size="13">ğŸ¨ Arquiteto Frontend</text>
  <text x="130" y="115" font-size="12">Freelancer / Independente</text>
  <text x="230" y="270" text-anchor="middle" font-size="11" fill="#555">Gerado em ${DATE}</text>
</svg>
EOF

      - name: ğŸ’¾ Commit e Push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          git add guild/
          git commit -m "ğŸ§™ CartÃ£o da Guilda gerado para lowlighter" || echo "Nada a commitar"
          git push
