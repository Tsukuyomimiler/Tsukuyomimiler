name: Recreate Character Card

on:
  workflow_dispatch:

jobs:
  recreate-card:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.11'

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install pillow requests

      - name: Download font
        run: |
          mkdir -p fonts
          curl -L -o fonts/EbGaramond-Regular.ttf https://github.com/google/fonts/raw/main/ofl/ebgaramond/EbGaramond-Regular.ttf

      - name: Generate image with Pillow
        run: |
          cat > generate_card.py <<'PY'
from PIL import Image, ImageDraw, ImageFont

# Canvas settings
W, H = 1600, 1000
bg_color = (0, 0, 0, 0)  # transparent background
card_margin = 60
card_w = W - card_margin*2
card_h = H - card_margin*2
card_x = card_margin
card_y = card_margin

# Colors
paper = (245, 235, 210, 255)
border = (60, 40, 20, 255)
accent = (120, 80, 40, 255)
text_color = (30, 20, 10, 255)
icon_color = (80, 50, 30, 255)

# Create image with transparency
img = Image.new("RGBA", (W, H), bg_color)
draw = ImageDraw.Draw(img)

# Load font (fallback to default if not found)
try:
    title_font = ImageFont.truetype("fonts/EbGaramond-Regular.ttf", 48)
    header_font = ImageFont.truetype("fonts/EbGaramond-Regular.ttf", 36)
    body_font = ImageFont.truetype("fonts/EbGaramond-Regular.ttf", 28)
    mono_font = ImageFont.truetype("fonts/EbGaramond-Regular.ttf", 24)
except Exception:
    title_font = ImageFont.load_default()
    header_font = ImageFont.load_default()
    body_font = ImageFont.load_default()
    mono_font = ImageFont.load_default()

# Draw parchment-like card rectangle with border
draw.rounded_rectangle([card_x, card_y, card_x+card_w, card_y+card_h], radius=24, fill=paper, outline=border, width=6)

# Decorative inner border
inner_pad = 28
draw.rounded_rectangle([card_x+inner_pad, card_y+inner_pad, card_x+card_w-inner_pad, card_y+card_h-inner_pad], radius=18, outline=accent, width=3)

# Top-left labels
labels_x = card_x + 60
labels_y = card_y + 60
label_w = 420
label_h = 64
gap = 12

def draw_label(x, y, w, h, label, value):
    draw.rectangle([x, y, x+w, y+h], outline=border, width=3, fill=(255,255,255,0))
    draw.text((x+12, y+8), f"{label}: {value}", font=header_font, fill=text_color)

draw_label(labels_x, labels_y, label_w, label_h, "NAME", "H/N")
draw_label(labels_x, labels_y + (label_h+gap), label_w, label_h, "CLASS", "Superhero")
draw_label(labels_x, labels_y + 2*(label_h+gap), label_w, label_h, "GUILD", "14Ball Official")

# Top-right silhouette box
sil_x = card_x + card_w - 320
sil_y = card_y + 60
sil_w = 220
sil_h = 220
draw.rectangle([sil_x, sil_y, sil_x+sil_w, sil_y+sil_h], outline=border, width=3)
# simple silhouette
cx = sil_x + sil_w//2
cy = sil_y + sil_h//2 - 10
draw.ellipse([cx-40, cy-70, cx+40, cy-10], fill=icon_color)  # head
draw.rectangle([cx-60, cy-10, cx+60, cy+80], fill=icon_color)  # torso

# Basic info row under silhouette
info_x = sil_x
info_y = sil_y + sil_h + 12
draw.text((info_x, info_y), "AGE: 17   RACE: Human   GENDER: M", font=body_font, fill=text_color)

# Inventory paragraph
inv_x = labels_x
inv_y = labels_y + 3*(label_h+gap) + 20
inv_w = card_w - 2*60 - sil_w - 40
inv_text = ("INV: Being from another dimension, H/N doesn’t have any powers. "
            "Though, being a very good fighter mixed with having knowledge of most everything "
            "makes him a formidable adversary.")
# wrap text
def draw_text_box(x, y, w, text, font, fill):
    words = text.split()
    line = ""
    line_h = font.getsize("A")[1] + 6
    cur_y = y
    for word in words:
        test = line + (" " if line else "") + word
        if font.getsize(test)[0] <= w:
            line = test
        else:
            draw.text((x, cur_y), line, font=font, fill=fill)
            cur_y += line_h
            line = word
    if line:
        draw.text((x, cur_y), line, font=font, fill=fill)
    return cur_y + line_h

inv_end_y = draw_text_box(inv_x, inv_y, inv_w, inv_text, body_font, text_color)

# Stats column
stats_x = labels_x
stats_y = inv_end_y + 20
stats_w = 520
draw.text((stats_x, stats_y), "STATS // SKILLS", font=header_font, fill=text_color)
stats = [
    ("STRENGTH", "7"),
    ("HEALTH", "8"),
    ("MAGIC POW", "0"),
    ("DEXTERITY", "9"),
    ("AGILITY", "6"),
    ("LUK", "9"),
]
line_y = stats_y + 48
for name, val in stats:
    draw.line([stats_x, line_y+18, stats_x+stats_w-20, line_y+18], fill=accent, width=1)
    draw.text((stats_x+6, line_y), f"{name}", font=body_font, fill=text_color)
    draw.text((stats_x+stats_w-60, line_y), f"{val}", font=body_font, fill=text_color)
    line_y += 44

# Active skills column
skills_x = stats_x + stats_w + 40
skills_y = stats_y
skills_w = 360
draw.text((skills_x, skills_y), "ACTIVE SKILLS", font=header_font, fill=text_color)
draw.line([skills_x, skills_y+48, skills_x+skills_w, skills_y+48], fill=accent, width=1)
draw.text((skills_x+6, skills_y+64), "• Determination", font=body_font, fill=text_color)
draw.text((skills_x+6, skills_y+64+40), "• Spinjitzu", font=body_font, fill=text_color)

# LVL box
lvl_x = skills_x + skills_w + 20
lvl_y = skills_y + 20
draw.rectangle([lvl_x, lvl_y, lvl_x+120, lvl_y+120], outline=border, width=3)
draw.text((lvl_x+18, lvl_y+28), "LVL", font=header_font, fill=text_color)
draw.text((lvl_x+46, lvl_y+64), "2", font=title_font, fill=text_color)

# Superhero ranking column with simple icons
rank_x = lvl_x + 160
rank_y = skills_y
rank_w = 160
draw.text((rank_x, rank_y), "SUPERHERO RANKING", font=body_font, fill=text_color)
# draw a vertical column of simple geometric icons
icon_start_y = rank_y + 48
icon_gap = 36
# diamond
draw.polygon([(rank_x+rank_w//2, icon_start_y),
              (rank_x+rank_w-8, icon_start_y+18),
              (rank_x+rank_w//2, icon_start_y+36),
              (rank_x+8, icon_start_y+18)], outline=icon_color, fill=None)
icon_start_y += icon_gap
# four small squares with symbols (represented as simple shapes)
for i in range(4):
    sx = rank_x + 12 + (i%2)*56
    sy = icon_start_y + (i//2)*56
    draw.rectangle([sx, sy, sx+40, sy+40], outline=icon_color, width=2)
# center circle
draw.ellipse([rank_x+rank_w//2-18, icon_start_y+56-18, rank_x+rank_w//2+18, icon_start_y+56+18], outline=icon_color, width=2)
# sun-like symbol
draw.ellipse([rank_x+rank_w//2-22, icon_start_y+140-22, rank_x+rank_w//2+22, icon_start_y+140+22], outline=icon_color, width=2)
# hourglass
draw.line([rank_x+rank_w//2-18, icon_start_y+200, rank_x+rank_w//2+18, icon_start_y+200], fill=icon_color, width=2)
draw.line([rank_x+rank_w//2-18, icon_start_y+200, rank_x+rank_w//2+18, icon_start_y+260], fill=icon_color, width=2)

# Footer small label
footer_text = "SUPERHERO RANKING: D"
draw.text((card_x + 60, card_y + card_h - 60), footer_text, font=mono_font, fill=text_color)

# Save PNG with transparency
img.save("recreated_card.png", format="PNG")
print("Saved recreated_card.png")
PY
          python generate_card.py

      - name: Upload generated image
        uses: actions/upload-artifact@v4
        with:
          name: recreated-card
          path: recreated_card.png
