name: "üé¥ ANIME SUPERHERO CARD"

on:
  workflow_dispatch:
    inputs:
      github_user:
        description: 'Usu√°rio do GitHub (para foto)'
        required: true
        default: 'ciconha'
      hero_name:
        description: 'Nome do Her√≥i'
        required: true
        default: 'H/N'
      hero_class:
        description: 'Classe'
        required: false
        default: 'Superhero'
      guild:
        description: 'Guilda/Afilia√ß√£o'
        required: false
        default: '14Ball Official'
      species:
        description: 'Esp√©cie'
        required: false
        default: 'Human'
      backstory:
        description: 'Hist√≥ria'
        required: false
        default: 'Being from another dimension, H/N doesn''t have any powers. Though, being a very good fighter mixed with having knowledge of most everything makes him a formidable adversary.'
      
      # Stats
      strength:
        description: 'For√ßa (1-10)'
        required: false
        default: '7'
      health:
        description: 'Sa√∫de (1-10)'
        required: false
        default: '8'
      magic:
        description: 'Poder M√°gico (1-10)'
        required: false
        default: '5'
      dexterity:
        description: 'Destreza (1-10)'
        required: false
        default: '9'
      agility:
        description: 'Agilidade (1-10)'
        required: false
        default: '8'
      luck:
        description: 'Sorte (1-10)'
        required: false
        default: '6'
      
      # Skills
      skill_1:
        description: 'Habilidade 1'
        required: false
        default: 'Determination'
      skill_2:
        description: 'Habilidade 2'
        required: false
        default: 'Spinitzu'
      skill_3:
        description: 'Habilidade 3'
        required: false
        default: ''
      skill_4:
        description: 'Habilidade 4'
        required: false
        default: ''
      
      # Ranking
      ranking:
        description: 'Ranking (S, A, B, C)'
        required: false
        default: 'A'

permissions:
  contents: write

jobs:
  create-card:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout do reposit√≥rio
        uses: actions/checkout@v4
      
      - name: ‚öôÔ∏è Instalar depend√™ncias
        run: |
          sudo apt-get update -y
          sudo apt-get install -y curl jq
      
      - name: üñºÔ∏è Buscar imagem do GitHub
        id: get-avatar
        run: |
          USER="${{ github.event.inputs.github_user }}"
          echo "üîç Buscando avatar para: $USER"
          
          # Tentar com token se dispon√≠vel, sen√£o sem token
          if [ -n "${{ secrets.GITHUB_TOKEN }}" ]; then
            curl -s -H "Authorization: token ${{ secrets.GITHUB_TOKEN }}" \
                 "https://api.github.com/users/$USER" > user_data.json
          else
            curl -s "https://api.github.com/users/$USER" > user_data.json
          fi
          
          # Extrair URL do avatar (usar tamanho maior)
          AVATAR_URL=$(jq -r '.avatar_url' user_data.json 2>/dev/null | sed 's/\?v=.*//')
          if [ -z "$AVATAR_URL" ] || [ "$AVATAR_URL" = "null" ]; then
            AVATAR_URL="https://avatars.githubusercontent.com/u/583231?v=4" # Fallback
          fi
          
          # Adicionar tamanho maior
          AVATAR_URL="${AVATAR_URL}&s=200"
          
          echo "avatar_url=$AVATAR_URL" >> $GITHUB_OUTPUT
          echo "‚úÖ Avatar URL: $AVATAR_URL"
      
      - name: üé® Criar diret√≥rio para cards
        run: mkdir -p cards
      
      - name: üñºÔ∏è Gerar SVG Anime Card
        run: |
          # Pegar os valores dos inputs
          HERO_NAME="${{ github.event.inputs.hero_name }}"
          HERO_CLASS="${{ github.event.inputs.hero_class }}"
          GUILD="${{ github.event.inputs.guild }}"
          SPECIES="${{ github.event.inputs.species }}"
          BACKSTORY="${{ github.event.inputs.backstory }}"
          RANKING="${{ github.event.inputs.ranking }}"
          AVATAR_URL="${{ steps.get-avatar.outputs.avatar_url }}"
          
          # Stats
          STR="${{ github.event.inputs.strength }}"
          HEALTH="${{ github.event.inputs.health }}"
          MAGIC="${{ github.event.inputs.magic }}"
          DEX="${{ github.event.inputs.dexterity }}"
          AGI="${{ github.event.inputs.agility }}"
          LUCK="${{ github.event.inputs.luck }}"
          
          # Skills
          SKILL1="${{ github.event.inputs.skill_1 }}"
          SKILL2="${{ github.event.inputs.skill_2 }}"
          SKILL3="${{ github.event.inputs.skill_3 }}"
          SKILL4="${{ github.event.inputs.skill_4 }}"
          
          # Data atual
          DATE=$(date +'%d/%m/%Y')
          
          # Cores anime
          BG_COLOR="#0a0a1a"
          CARD_COLOR="#1a1a2e"
          ACCENT_COLOR="#00b4d8"
          TEXT_COLOR="#e2e8f0"
          STAT_BAR_BG="#2d3748"
          STAT_BAR_FILL="#4fd1c7"
          SKILL_COLOR="#81e6d9"
          RANK_S="#fbbf24"
          RANK_A="#f87171"
          RANK_B="#60a5fa"
          RANK_C="#34d399"
          
          # Cor do ranking
          case "$RANKING" in
            "S") RANK_COLOR="$RANK_S" ;;
            "A") RANK_COLOR="$RANK_A" ;;
            "B") RANK_COLOR="$RANK_B" ;;
            "C") RANK_COLOR="$RANK_C" ;;
            *) RANK_COLOR="$ACCENT_COLOR" ;;
          esac
          
          # Calcular larguras das barras (130px max)
          STR_BAR=$((STR * 13))
          HEALTH_BAR=$((HEALTH * 13))
          MAGIC_BAR=$((MAGIC * 13))
          DEX_BAR=$((DEX * 13))
          AGI_BAR=$((AGI * 13))
          LUCK_BAR=$((LUCK * 13))
          
          # Garantir m√°ximo
          [ $STR_BAR -gt 130 ] && STR_BAR=130
          [ $HEALTH_BAR -gt 130 ] && HEALTH_BAR=130
          [ $MAGIC_BAR -gt 130 ] && MAGIC_BAR=130
          [ $DEX_BAR -gt 130 ] && DEX_BAR=130
          [ $AGI_BAR -gt 130 ] && AGI_BAR=130
          [ $LUCK_BAR -gt 130 ] && LUCK_BAR=130
          
          # Nome do arquivo
          FILENAME=$(echo "$HERO_NAME" | tr -cd '[:alnum:]-_ ' | tr ' ' '_')
          SVG_FILE="cards/${FILENAME}.svg"
          
          # Criar o arquivo SVG com design anime
          cat > "$SVG_FILE" << EOF
          <svg xmlns="http://www.w3.org/2000/svg" width="500" height="700" viewBox="0 0 500 700">
          <defs>
            <style>
              @import url('https://fonts.googleapis.com/css2?family=Exo+2:wght@300;400;600;700&family=Roboto+Mono:wght@300;400&family=Poppins:wght@400;600;700&display=swap');
              
              .hero-name {
                font-family: 'Poppins', sans-serif;
                font-size: 28px;
                font-weight: 700;
                fill: white;
                letter-spacing: 0.5px;
              }
              
              .section-title {
                font-family: 'Exo 2', sans-serif;
                font-size: 16px;
                font-weight: 600;
                fill: #00b4d8;
                letter-spacing: 1px;
              }
              
              .label {
                font-family: 'Exo 2', sans-serif;
                font-size: 12px;
                font-weight: 400;
                fill: #a0aec0;
              }
              
              .value {
                font-family: 'Roboto Mono', monospace;
                font-size: 11px;
                font-weight: 400;
                fill: #e2e8f0;
              }
              
              .skill-text {
                font-family: 'Roboto Mono', monospace;
                font-size: 10px;
                fill: #81e6d9;
              }
              
              .backstory-text {
                font-family: 'Roboto Mono', monospace;
                font-size: 10px;
                fill: #cbd5e0;
                line-height: 14px;
              }
              
              .rank-text {
                font-family: 'Poppins', sans-serif;
                font-size: 32px;
                font-weight: 700;
                fill: $RANK_COLOR;
                text-shadow: 0 0 10px $RANK_COLOR;
              }
            </style>
            
            <!-- Gradientes -->
            <linearGradient id="cardGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#1a1a2e" />
              <stop offset="100%" stop-color="#16213e" />
            </linearGradient>
            
            <linearGradient id="statGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#4fd1c7" />
              <stop offset="50%" stop-color="#38b2ac" />
              <stop offset="100%" stop-color="#4fd1c7" />
            </linearGradient>
            
            <linearGradient id="headerGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#00b4d8" />
              <stop offset="100%" stop-color="#0077b6" />
            </linearGradient>
            
            <!-- Filtros -->
            <filter id="shadow" x="-20%" y="-20%" width="140%" height="140%">
              <feDropShadow dx="0" dy="4" stdDeviation="8" flood-color="#000" flood-opacity="0.3"/>
            </filter>
            
            <filter id="glow">
              <feGaussianBlur stdDeviation="2" result="blur"/>
              <feMerge>
                <feMergeNode in="blur"/>
                <feMergeNode in="SourceGraphic"/>
              </feMerge>
            </filter>
          </defs>
          
          <!-- Fundo com gradiente escuro -->
          <rect width="500" height="700" rx="20" ry="20" fill="$BG_COLOR"/>
          
          <!-- Card principal -->
          <g filter="url(#shadow)">
            <rect x="20" y="20" width="460" height="660" rx="20" ry="20" fill="url(#cardGradient)" stroke="#00b4d8" stroke-width="1" opacity="0.9"/>
          </g>
          
          <!-- C√≠rculo da foto -->
          <defs>
            <clipPath id="circleClip">
              <circle cx="250" cy="120" r="60"/>
            </clipPath>
          </defs>
          
          <!-- Container da foto -->
          <circle cx="250" cy="120" r="62" fill="url(#headerGradient)"/>
          <circle cx="250" cy="120" r="60" fill="#1a1a2e"/>
          
          <!-- Foto do GitHub (ser√° renderizada pelo navegador) -->
          <image href="$AVATAR_URL" x="190" y="60" width="120" height="120" clip-path="url(#circleClip)" opacity="0.9"/>
          
          <!-- Brilho na foto -->
          <circle cx="250" cy="120" r="60" fill="none" stroke="url(#headerGradient)" stroke-width="2" opacity="0.5"/>
          
          <!-- Nome do her√≥i -->
          <text x="250" y="210" text-anchor="middle" class="hero-name">$HERO_NAME</text>
          
          <!-- Badge da classe -->
          <rect x="200" y="220" width="100" height="24" rx="12" ry="12" fill="url(#headerGradient)" opacity="0.8"/>
          <text x="250" y="236" text-anchor="middle" class="value" font-weight="600">$HERO_CLASS</text>
          
          <!-- Informa√ß√µes em grid -->
          <g transform="translate(40, 260)">
            <!-- Guilda -->
            <rect x="0" y="0" width="200" height="40" rx="10" ry="10" fill="#2d3748" opacity="0.7"/>
            <text x="10" y="15" class="label">GUILDA</text>
            <text x="10" y="30" class="value">$GUILD</text>
            
            <!-- Esp√©cie -->
            <rect x="220" y="0" width="200" height="40" rx="10" ry="10" fill="#2d3748" opacity="0.7"/>
            <text x="230" y="15" class="label">ESP√âCIE</text>
            <text x="230" y="30" class="value">$SPECIES</text>
          </g>
          
          <!-- Hist√≥ria -->
          <g transform="translate(40, 320)">
            <rect x="0" y="0" width="420" height="80" rx="12" ry="12" fill="#2d3748" opacity="0.7"/>
            <text x="15" y="20" class="section-title">HIST√ìRIA</text>
            <foreignObject x="15" y="30" width="390" height="60">
              <div xmlns="http://www.w3.org/1999/xhtml" style="font-family: 'Roboto Mono', monospace; font-size: 10px; color: #cbd5e0; line-height: 1.4;">
                $BACKSTORY
              </div>
            </foreignObject>
          </g>
          
          <!-- Se√ß√£o de Stats -->
          <g transform="translate(40, 420)">
            <text x="0" y="0" class="section-title">ATRIBUTOS</text>
            
            <!-- Grid 2x3 de stats -->
            <g transform="translate(0, 25)">
              <!-- Linha 1 -->
              <!-- STRENGTH -->
              <g transform="translate(0, 0)">
                <text x="0" y="0" class="label">FOR√áA</text>
                <rect x="0" y="5" width="130" height="8" rx="4" ry="4" fill="$STAT_BAR_BG"/>
                <rect x="0" y="5" width="$STR_BAR" height="8" rx="4" ry="4" fill="url(#statGradient)"/>
                <text x="135" y="12" class="value">$STR/10</text>
              </g>
              
              <!-- HEALTH -->
              <g transform="translate(220, 0)">
                <text x="0" y="0" class="label">SA√öDE</text>
                <rect x="0" y="5" width="130" height="8" rx="4" ry="4" fill="$STAT_BAR_BG"/>
                <rect x="0" y="5" width="$HEALTH_BAR" height="8" rx="4" ry="4" fill="url(#statGradient)"/>
                <text x="135" y="12" class="value">$HEALTH/10</text>
              </g>
              
              <!-- Linha 2 -->
              <!-- MAGIC -->
              <g transform="translate(0, 40)">
                <text x="0" y="0" class="label">MAGIA</text>
                <rect x="0" y="5" width="130" height="8" rx="4" ry="4" fill="$STAT_BAR_BG"/>
                <rect x="0" y="5" width="$MAGIC_BAR" height="8" rx="4" ry="4" fill="url(#statGradient)"/>
                <text x="135" y="12" class="value">$MAGIC/10</text>
              </g>
              
              <!-- DEXTERITY -->
              <g transform="translate(220, 40)">
                <text x="0" y="0" class="label">DESTREZA</text>
                <rect x="0" y="5" width="130" height="8" rx="4" ry="4" fill="$STAT_BAR_BG"/>
                <rect x="0" y="5" width="$DEX_BAR" height="8" rx="4" ry="4" fill="url(#statGradient)"/>
                <text x="135" y="12" class="value">$DEX/10</text>
              </g>
              
              <!-- Linha 3 -->
              <!-- AGILITY -->
              <g transform="translate(0, 80)">
                <text x="0" y="0" class="label">AGILIDADE</text>
                <rect x="0" y="5" width="130" height="8" rx="4" ry="4" fill="$STAT_BAR_BG"/>
                <rect x="0" y="5" width="$AGI_BAR" height="8" rx="4" ry="4" fill="url(#statGradient)"/>
                <text x="135" y="12" class="value">$AGI/10</text>
              </g>
              
              <!-- LUCK -->
              <g transform="translate(220, 80)">
                <text x="0" y="0" class="label">SORTE</text>
                <rect x="0" y="5" width="130" height="8" rx="4" ry="4" fill="$STAT_BAR_BG"/>
                <rect x="0" y="5" width="$LUCK_BAR" height="8" rx="4" ry="4" fill="url(#statGradient)"/>
                <text x="135" y="12" class="value">$LUCK/10</text>
              </g>
            </g>
          </g>
          
          <!-- Habilidades -->
          <g transform="translate(40, 560)">
            <text x="0" y="0" class="section-title">HABILIDADES</text>
            <rect x="0" y="15" width="420" height="70" rx="12" ry="12" fill="#2d3748" opacity="0.7"/>
            
            <g transform="translate(15, 35)">
              <!-- Coluna 1 -->
EOF

          # Adicionar skills dinamicamente
          SKILLS_X=0
          SKILLS_Y=0
          SKILL_COUNT=0
          
          if [ -n "$SKILL1" ]; then
            echo "              <text x=\"$SKILLS_X\" y=\"$SKILLS_Y\" class=\"skill-text\">‚ú¶ $SKILL1</text>" >> "$SVG_FILE"
            SKILLS_Y=$((SKILLS_Y + 18))
            SKILL_COUNT=$((SKILL_COUNT + 1))
          fi
          
          if [ -n "$SKILL2" ]; then
            echo "              <text x=\"$SKILLS_X\" y=\"$SKILLS_Y\" class=\"skill-text\">‚ú¶ $SKILL2</text>" >> "$SVG_FILE"
            SKILLS_Y=$((SKILLS_Y + 18))
            SKILL_COUNT=$((SKILL_COUNT + 1))
          fi
          
          # Segunda coluna
          if [ -n "$SKILL3" ] || [ -n "$SKILL4" ]; then
            echo "            </g>" >> "$SVG_FILE"
            echo "            <g transform=\"translate(210, 35)\">" >> "$SVG_FILE"
            
            if [ -n "$SKILL3" ]; then
              echo "              <text x=\"0\" y=\"0\" class=\"skill-text\">‚ú¶ $SKILL3</text>" >> "$SVG_FILE"
              SKILL_COUNT=$((SKILL_COUNT + 1))
            fi
            
            if [ -n "$SKILL4" ]; then
              echo "              <text x=\"0\" y=\"18\" class=\"skill-text\">‚ú¶ $SKILL4</text>" >> "$SVG_FILE"
              SKILL_COUNT=$((SKILL_COUNT + 1))
            fi
          fi
          
          # Preencher slots vazios
          if [ $SKILL_COUNT -lt 4 ]; then
            if [ $SKILL_COUNT -eq 0 ] || [ $SKILL_COUNT -eq 2 ]; then
              echo "            </g>" >> "$SVG_FILE"
              echo "            <g transform=\"translate(210, 35)\">" >> "$SVG_FILE"
            fi
            
            for ((i=SKILL_COUNT; i<4; i++)); do
              if [ $i -lt 2 ]; then
                POS_Y=$((i * 18))
                echo "              <text x=\"0\" y=\"$POS_Y\" class=\"skill-text\" opacity=\"0.4\">‚ú¶ [Slot Vazio]</text>" >> "$SVG_FILE"
              else
                POS_Y=$(((i-2) * 18))
                echo "              <text x=\"0\" y=\"$POS_Y\" class=\"skill-text\" opacity=\"0.4\">‚ú¶ [Slot Vazio]</text>" >> "$SVG_FILE"
              fi
            done
          fi
          
          # Continuar SVG
          cat >> "$SVG_FILE" << EOF
            </g>
          </g>
          
          <!-- Rodap√© com Ranking -->
          <g transform="translate(40, 640)">
            <rect x="0" y="0" width="420" height="40" rx="20" ry="20" fill="#2d3748" opacity="0.8"/>
            
            <!-- Texto Superhero -->
            <text x="15" y="25" class="section-title">SUPER HER√ìI</text>
            
            <!-- Badge do Ranking -->
            <circle cx="380" cy="20" r="16" fill="$RANK_COLOR" opacity="0.9" filter="url(#glow)"/>
            <text x="380" y="26" text-anchor="middle" class="rank-text">$RANKING</text>
            
            <!-- Label Ranking -->
            <text x="380" y="38" text-anchor="middle" class="label" font-size="9">RANK</text>
          </g>
          
          <!-- Data e detalhes -->
          <g transform="translate(40, 685)">
            <text x="0" y="0" class="label" font-size="9">Gerado em: $DATE</text>
            <text x="350" y="0" text-anchor="end" class="label" font-size="9">ID: $(date +%s | tail -c 6)</text>
          </g>
          
          <!-- Elementos decorativos anime -->
          <!-- Brilhos -->
          <circle cx="80" cy="80" r="8" fill="#00b4d8" opacity="0.3" filter="url(#glow)"/>
          <circle cx="420" cy="80" r="6" fill="#4fd1c7" opacity="0.3" filter="url(#glow)"/>
          <circle cx="100" cy="600" r="5" fill="#81e6d9" opacity="0.3" filter="url(#glow)"/>
          <circle cx="400" cy="620" r="7" fill="#00b4d8" opacity="0.3" filter="url(#glow)"/>
          
          <!-- Linhas decorativas -->
          <line x1="40" y1="30" x2="460" y2="30" stroke="url(#headerGradient)" stroke-width="1" opacity="0.5"/>
          <line x1="40" y1="670" x2="460" y2="670" stroke="url(#headerGradient)" stroke-width="1" opacity="0.5"/>
          
          </svg>
          EOF
          
          echo "‚ú® Card anime gerado: $SVG_FILE"
          echo "üé® Design: Anime 2D Minimalista"
          echo "üñºÔ∏è Avatar: $AVATAR_URL"
      
      - name: üì§ Commit e Push
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          if git status --porcelain | grep -q "cards/"; then
            git add cards/
            git commit -m "üé¥ Novo card anime: ${{ github.event.inputs.hero_name }}"
            git push
            echo "‚úÖ Card anime salvo com sucesso!"
          else
            echo "‚ö†Ô∏è Nenhuma altera√ß√£o para commitar"
          fi
        env:
          GITHUB_TOKEN: \${{ secrets.GITHUB_TOKEN }}
