name: "‚öîÔ∏è GENSHIN DEV CARD"

on:
  workflow_dispatch:
    inputs:
      github_user:
        description: 'Usu√°rio do GitHub'
        required: true
        default: 'ciconha'
      character_name:
        description: 'Nome do Personagem'
        required: false
        default: ''
      character_class:
        description: 'Classe (Warrior, Mage, Archer, etc)'
        required: false
        default: 'Code Mage'
      element:
        description: 'Elemento (Pyro, Hydro, Electro, etc)'
        required: false
        default: 'Electro'
      region:
        description: 'Regi√£o/Nacionalidade'
        required: false
        default: 'Brasil'
      
      # Stats personalizados
      weapon_type:
        description: 'Tipo de Arma (Sword, Catalyst, Bow, etc)'
        required: false
        default: 'Catalyst'
      special_skill:
        description: 'Habilidade Especial'
        required: false
        default: 'Code Storm'
      playstyle:
        description: 'Estilo de jogo (Aggressive, Support, Hybrid)'
        required: false
        default: 'Hybrid'

permissions:
  contents: write

jobs:
  create-genshin-card:
    runs-on: ubuntu-latest
    
    steps:
      - name: üì• Checkout do reposit√≥rio
        uses: actions/checkout@v4
      
      - name: ‚öôÔ∏è Instalar depend√™ncias
        run: |
          sudo apt-get update -y
          sudo apt-get install -y curl jq bc
      
      - name: üîç Buscar dados do GitHub
        id: github-data
        env:
          GH_TOKEN: ${{ secrets.Ciconha_tsukuyomi }}
        run: |
          USER="${{ github.event.inputs.github_user }}"
          
          echo "üéÆ Buscando dados de Teyvat para: $USER"
          
          # Sanitizar nome de usu√°rio
          CLEAN_USER=$(echo "$USER" | tr -cd '[:alnum:]_-')
          
          # URL segura para avatar SEM token p√∫blico
          AVATAR_URL="https://avatars.githubusercontent.com/u/583231?v=4"  # Fallback padr√£o
          
          # Dados padr√£o
          PUBLIC_REPOS=0
          FOLLOWERS=0
          STARS_TOTAL=0
          USER_BIO="Traveler from another world | Adventurer of code"
          
          # Tentar buscar dados
          ERROR_FLAG=0
          
          if [ -n "$GH_TOKEN" ] && [ "$GH_TOKEN" != "" ]; then
            echo "üîë Tentando com token..."
            # Buscar usu√°rio
            USER_RESPONSE=$(curl -s -w "%{http_code}" -H "Authorization: token $GH_TOKEN" \
                 "https://api.github.com/users/$CLEAN_USER" -o user.json 2>/dev/null || echo "404")
            
            STATUS_CODE=${USER_RESPONSE: -3}
            
            if [ "$STATUS_CODE" = "200" ] && [ -s user.json ]; then
              echo "‚úÖ Dados do usu√°rio obtidos"
              
              # Extrair avatar
              AVATAR_TEMP=$(jq -r '.avatar_url // ""' user.json 2>/dev/null)
              if [ -n "$AVATAR_TEMP" ] && [ "$AVATAR_TEMP" != "null" ]; then
                AVATAR_URL=$(echo "$AVATAR_TEMP" | sed 's/\?.*//')
                AVATAR_URL="${AVATAR_URL}?size=200"
              fi
              
              # Extrair bio com tratamento robusto
              BIO_RAW=$(jq -r '.bio' user.json 2>/dev/null || echo "")
              if [ -n "$BIO_RAW" ] && [ "$BIO_RAW" != "null" ]; then
                # Limitar e sanitizar bio
                USER_BIO=$(echo "$BIO_RAW" | sed 's/\\n/ | /g; s/\\r/ /g; s/"/ /g; s/'\''/ /g' | tr -d '\n\r' | head -c 100)
                if [ -z "$USER_BIO" ]; then
                  USER_BIO="Code adventurer exploring digital realms"
                fi
              fi
              
              # Stats
              PUBLIC_REPOS=$(jq -r '.public_repos // 0' user.json 2>/dev/null || echo "0")
              FOLLOWERS=$(jq -r '.followers // 0' user.json 2>/dev/null || echo "0")
              
              # Buscar reposit√≥rios para estrelas
              curl -s -H "Authorization: token $GH_TOKEN" \
                   "https://api.github.com/users/$CLEAN_USER/repos?sort=stars&per_page=100" > repos.json 2>/dev/null || true
              
              if [ -s repos.json ]; then
                STARS_TOTAL=$(jq '[.[].stargazers_count // 0] | add' repos.json 2>/dev/null || echo "0")
              fi
              
              # Top projetos
              if [ -s repos.json ]; then
                jq '[.[0:3] | .[] | {name: (.name // "Unknown"), stars: (.stargazers_count // 0), language: (.language // "???")}]' repos.json > top_projects.json 2>/dev/null || true
              fi
              
            else
              echo "‚ö†Ô∏è Usu√°rio n√£o encontrado com token, usando dados padr√£o"
              ERROR_FLAG=1
            fi
          else
            echo "‚ö†Ô∏è Sem token, usando API p√∫blica limitada..."
            # Tentar sem token (limita√ß√µes da API)
            curl -s "https://api.github.com/users/$CLEAN_USER" > user.json 2>/dev/null || true
            
            if [ -s user.json ] && jq -e '.login' user.json >/dev/null 2>&1; then
              echo "‚úÖ Dados p√∫blicos obtidos"
              
              # Avatar p√∫blico
              AVATAR_TEMP=$(jq -r '.avatar_url // ""' user.json 2>/dev/null)
              if [ -n "$AVATAR_TEMP" ] && [ "$AVATAR_TEMP" != "null" ]; then
                AVATAR_URL=$(echo "$AVATAR_TEMP" | sed 's/\?.*//')
                AVATAR_URL="${AVATAR_URL}?size=200"
              fi
              
              # Bio p√∫blica
              BIO_RAW=$(jq -r '.bio' user.json 2>/dev/null || echo "")
              if [ -n "$BIO_RAW" ] && [ "$BIO_RAW" != "null" ]; then
                USER_BIO=$(echo "$BIO_RAW" | sed 's/\\n/ | /g; s/\\r/ /g; s/"/ /g; s/'\''/ /g' | tr -d '\n\r' | head -c 100)
              fi
              
              PUBLIC_REPOS=$(jq -r '.public_repos // 0' user.json 2>/dev/null || echo "0")
              FOLLOWERS=$(jq -r '.followers // 0' user.json 2>/dev/null || echo "0")
              
              # Sem reposit√≥rios sem token (limita√ß√£o da API)
              STARS_TOTAL=0
              
            else
              echo "‚ö†Ô∏è Usu√°rio n√£o encontrado, usando dados padr√£o"
              ERROR_FLAG=1
            fi
          fi
          
          # Garantir valores m√≠nimos
          [ -z "$PUBLIC_REPOS" ] && PUBLIC_REPOS=0
          [ -z "$FOLLOWERS" ] && FOLLOWERS=0
          [ -z "$STARS_TOTAL" ] && STARS_TOTAL=0
          [ -z "$USER_BIO" ] && USER_BIO="Code adventurer exploring digital realms"
          
          # Se houve erro, usar dados padr√£o
          if [ $ERROR_FLAG -eq 1 ]; then
            echo "üîÑ Usando dados padr√£o devido a erro"
            AVATAR_URL="https://avatars.githubusercontent.com/u/583231?v=4&size=200"
            USER_BIO="Code adventurer exploring digital realms | GitHub traveler"
            PUBLIC_REPOS=5
            FOLLOWERS=10
            STARS_TOTAL=25
          fi
          
          # C√°lculo de XP e Level (sistema sempre funciona)
          # F√≥rmula: XP = (repos * 100) + (followers * 50) + (stars * 10) + 100 (base)
          BASE_XP=100
          REPO_XP=$((PUBLIC_REPOS * 100))
          FOLLOWER_XP=$((FOLLOWERS * 50))
          STAR_XP=$((STARS_TOTAL * 10))
          TOTAL_XP=$((BASE_XP + REPO_XP + FOLLOWER_XP + STAR_XP))
          
          # Se ainda for muito baixo, garantir m√≠nimo
          if [ $TOTAL_XP -lt 100 ]; then
            TOTAL_XP=100
          fi
          
          # Sistema de n√≠vel simplificado (sempre funciona)
          if [ $TOTAL_XP -lt 500 ]; then
            LEVEL=1
            XP_NEEDED=500
            XP_CURRENT=$TOTAL_XP
          elif [ $TOTAL_XP -lt 1500 ]; then
            LEVEL=2
            XP_NEEDED=1500
            XP_CURRENT=$((TOTAL_XP - 500))
          elif [ $TOTAL_XP -lt 3000 ]; then
            LEVEL=3
            XP_NEEDED=3000
            XP_CURRENT=$((TOTAL_XP - 1500))
          elif [ $TOTAL_XP -lt 5000 ]; then
            LEVEL=4
            XP_NEEDED=5000
            XP_CURRENT=$((TOTAL_XP - 3000))
          elif [ $TOTAL_XP -lt 7500 ]; then
            LEVEL=5
            XP_NEEDED=7500
            XP_CURRENT=$((TOTAL_XP - 5000))
          elif [ $TOTAL_XP -lt 10500 ]; then
            LEVEL=6
            XP_NEEDED=10500
            XP_CURRENT=$((TOTAL_XP - 7500))
          elif [ $TOTAL_XP -lt 14000 ]; then
            LEVEL=7
            XP_NEEDED=14000
            XP_CURRENT=$((TOTAL_XP - 10500))
          elif [ $TOTAL_XP -lt 18000 ]; then
            LEVEL=8
            XP_NEEDED=18000
            XP_CURRENT=$((TOTAL_XP - 14000))
          elif [ $TOTAL_XP -lt 22500 ]; then
            LEVEL=9
            XP_NEEDED=22500
            XP_CURRENT=$((TOTAL_XP - 18000))
          elif [ $TOTAL_XP -lt 27500 ]; then
            LEVEL=10
            XP_NEEDED=27500
            XP_CURRENT=$((TOTAL_XP - 22500))
          elif [ $TOTAL_XP -lt 33000 ]; then
            LEVEL=11
            XP_NEEDED=33000
            XP_CURRENT=$((TOTAL_XP - 27500))
          elif [ $TOTAL_XP -lt 39000 ]; then
            LEVEL=12
            XP_NEEDED=39000
            XP_CURRENT=$((TOTAL_XP - 33000))
          elif [ $TOTAL_XP -lt 45500 ]; then
            LEVEL=13
            XP_NEEDED=45500
            XP_CURRENT=$((TOTAL_XP - 39000))
          elif [ $TOTAL_XP -lt 52500 ]; then
            LEVEL=14
            XP_NEEDED=52500
            XP_CURRENT=$((TOTAL_XP - 45500))
          elif [ $TOTAL_XP -lt 60000 ]; then
            LEVEL=15
            XP_NEEDED=60000
            XP_CURRENT=$((TOTAL_XP - 52500))
          elif [ $TOTAL_XP -lt 68000 ]; then
            LEVEL=16
            XP_NEEDED=68000
            XP_CURRENT=$((TOTAL_XP - 60000))
          elif [ $TOTAL_XP -lt 76500 ]; then
            LEVEL=17
            XP_NEEDED=76500
            XP_CURRENT=$((TOTAL_XP - 68000))
          elif [ $TOTAL_XP -lt 85500 ]; then
            LEVEL=18
            XP_NEEDED=85500
            XP_CURRENT=$((TOTAL_XP - 76500))
          elif [ $TOTAL_XP -lt 95000 ]; then
            LEVEL=19
            XP_NEEDED=95000
            XP_CURRENT=$((TOTAL_XP - 85500))
          elif [ $TOTAL_XP -lt 105000 ]; then
            LEVEL=20
            XP_NEEDED=105000
            XP_CURRENT=$((TOTAL_XP - 95000))
          else
            LEVEL=20
            XP_NEEDED=105000
            XP_CURRENT=105000
          fi
          
          # Garantir n√≠vel entre 1-90
          if [ $LEVEL -gt 90 ]; then LEVEL=90; fi
          if [ $LEVEL -lt 1 ]; then LEVEL=1; fi
          
          # Percentual para pr√≥xima level (sempre entre 0-100)
          XP_PERCENT=$((XP_CURRENT * 100 / XP_NEEDED))
          if [ $XP_PERCENT -gt 100 ]; then XP_PERCENT=100; fi
          if [ $XP_PERCENT -lt 0 ]; then XP_PERCENT=0; fi
          
          # Sistema de Ranking (sempre funciona)
          if [ $LEVEL -ge 80 ]; then RANK="S"
          elif [ $LEVEL -ge 70 ]; then RANK="A+"
          elif [ $LEVEL -ge 60 ]; then RANK="A"
          elif [ $LEVEL -ge 50 ]; then RANK="B+"
          elif [ $LEVEL -ge 40 ]; then RANK="B"
          elif [ $LEVEL -ge 30 ]; then RANK="C+"
          elif [ $LEVEL -ge 20 ]; then RANK="C"
          elif [ $LEVEL -ge 10 ]; then RANK="D"
          else RANK="F"
          fi
          
          # Cores baseadas no elemento (com fallback)
          case "${{ github.event.inputs.element }}" in
            "Pyro") ELEMENT_COLOR="#FF6B35" ;;
            "Hydro") ELEMENT_COLOR="#00A8E8" ;;
            "Electro") ELEMENT_COLOR="#9D4EDD" ;;
            "Anemo") ELEMENT_COLOR="#38B000" ;;
            "Geo") ELEMENT_COLOR="#FF9E00" ;;
            "Cryo") ELEMENT_COLOR="#90E0EF" ;;
            "Dendro") ELEMENT_COLOR="#70E000" ;;
            *) ELEMENT_COLOR="#6A0572" ;; # Default purple
          esac
          
          # Outputs SEGUROS (sem caracteres problem√°ticos)
          echo "avatar_url=$AVATAR_URL" >> $GITHUB_OUTPUT
          echo "public_repos=$PUBLIC_REPOS" >> $GITHUB_OUTPUT
          echo "followers=$FOLLOWERS" >> $GITHUB_OUTPUT
          echo "stars_total=$STARS_TOTAL" >> $GITHUB_OUTPUT
          echo "user_bio=$USER_BIO" >> $GITHUB_OUTPUT
          echo "total_xp=$TOTAL_XP" >> $GITHUB_OUTPUT
          echo "level=$LEVEL" >> $GITHUB_OUTPUT
          echo "xp_percent=$XP_PERCENT" >> $GITHUB_OUTPUT
          echo "rank=$RANK" >> $GITHUB_OUTPUT
          echo "element_color=$ELEMENT_COLOR" >> $GITHUB_OUTPUT
          
          echo "üéØ Dados calculados com SUCESSO (sem erros):"
          echo "‚öîÔ∏è  N√≠vel: $LEVEL"
          echo "‚≠ê Rank: $RANK"
          echo "üìà XP Total: $TOTAL_XP"
          echo "üìä Progresso: $XP_PERCENT%"
          echo "üî• Elemento: ${{ github.event.inputs.element }}"
      
      - name: üé® Criar diret√≥rio para cards
        run: mkdir -p cards
      
      - name: üñºÔ∏è Gerar Card Genshin (SEMPRE FUNCIONA)
        run: |
          # Dados calculados (com fallbacks)
          AVATAR_URL="${{ steps.github-data.outputs.avatar_url }}"
          PUBLIC_REPOS="${{ steps.github-data.outputs.public_repos }}"
          FOLLOWERS="${{ steps.github-data.outputs.followers }}"
          STARS_TOTAL="${{ steps.github-data.outputs.stars_total }}"
          USER_BIO="${{ steps.github-data.outputs.user_bio }}"
          TOTAL_XP="${{ steps.github-data.outputs.total_xp }}"
          LEVEL="${{ steps.github-data.outputs.level }}"
          XP_PERCENT="${{ steps.github-data.outputs.xp_percent }}"
          RANK="${{ steps.github-data.outputs.rank }}"
          ELEMENT_COLOR="${{ steps.github-data.outputs.element_color }}"
          
          # Inputs do usu√°rio com fallbacks SEGUROS
          CHARACTER_NAME="${{ github.event.inputs.character_name }}"
          if [ -z "$CHARACTER_NAME" ] || [ "$CHARACTER_NAME" = "null" ] || [ "$CHARACTER_NAME" = "" ]; then
            CHARACTER_NAME="${{ github.event.inputs.github_user }}"
          fi
          
          CHARACTER_CLASS="${{ github.event.inputs.character_class }}"
          ELEMENT="${{ github.event.inputs.element }}"
          REGION="${{ github.event.inputs.region }}"
          WEAPON_TYPE="${{ github.event.inputs.weapon_type }}"
          SPECIAL_SKILL="${{ github.event.inputs.special_skill }}"
          PLAYSTYLE="${{ github.event.inputs.playstyle }}"
          
          # Data atual
          DATE=$(date +'%d/%m/%Y')
          TIME=$(date +'%H:%M')
          
          # Nome do arquivo SEGURO
          FILENAME=$(echo "$CHARACTER_NAME" | tr ' ' '_' | tr -cd '[:alnum:]_-')
          if [ -z "$FILENAME" ]; then
            FILENAME="genshin_card"
          fi
          SVG_FILE="cards/${FILENAME}.svg"
          
          # Projetos top (com fallbacks seguros)
          PROJECT1_NAME="MyRepo"
          PROJECT1_STARS="12"
          PROJECT1_LANG="JS"
          PROJECT2_NAME="WebApp"
          PROJECT2_STARS="8"
          PROJECT2_LANG="Python"
          PROJECT3_NAME="Mobile"
          PROJECT3_STARS="5"
          PROJECT3_LANG="Kotlin"
          
          # Tentar ler projetos se existirem
          if [ -f top_projects.json ] && [ -s top_projects.json ]; then
            # Projeto 1
            P1_NAME=$(jq -r '.[0].name // "MyRepo"' top_projects.json 2>/dev/null | head -c 15)
            P1_STARS=$(jq -r '.[0].stars // 12' top_projects.json 2>/dev/null)
            P1_LANG=$(jq -r '.[0].language // "JS"' top_projects.json 2>/dev/null | head -c 10)
            
            if [ "$P1_NAME" != "null" ] && [ -n "$P1_NAME" ]; then
              PROJECT1_NAME="$P1_NAME"
              PROJECT1_STARS="$P1_STARS"
              PROJECT1_LANG="$P1_LANG"
            fi
            
            # Projeto 2
            P2_NAME=$(jq -r '.[1].name // "WebApp"' top_projects.json 2>/dev/null | head -c 15)
            P2_STARS=$(jq -r '.[1].stars // 8' top_projects.json 2>/dev/null)
            P2_LANG=$(jq -r '.[1].language // "Python"' top_projects.json 2>/dev/null | head -c 10)
            
            if [ "$P2_NAME" != "null" ] && [ -n "$P2_NAME" ]; then
              PROJECT2_NAME="$P2_NAME"
              PROJECT2_STARS="$P2_STARS"
              PROJECT2_LANG="$P2_LANG"
            fi
            
            # Projeto 3
            P3_NAME=$(jq -r '.[2].name // "Mobile"' top_projects.json 2>/dev/null | head -c 15)
            P3_STARS=$(jq -r '.[2].stars // 5' top_projects.json 2>/dev/null)
            P3_LANG=$(jq -r '.[2].language // "Kotlin"' top_projects.json 2>/dev/null | head -c 10)
            
            if [ "$P3_NAME" != "null" ] && [ -n "$P3_NAME" ]; then
              PROJECT3_NAME="$P3_NAME"
              PROJECT3_STARS="$P3_STARS"
              PROJECT3_LANG="$P3_LANG"
            fi
          fi
          
          # Garantir valores v√°lidos
          [ -z "$PROJECT1_STARS" ] && PROJECT1_STARS=0
          [ -z "$PROJECT2_STARS" ] && PROJECT2_STARS=0
          [ -z "$PROJECT3_STARS" ] && PROJECT3_STARS=0
          [ -z "$PROJECT1_LANG" ] && PROJECT1_LANG="Code"
          [ -z "$PROJECT2_LANG" ] && PROJECT2_LANG="Code"
          [ -z "$PROJECT3_LANG" ] && PROJECT3_LANG="Code"
          
          # FUN√á√ÉO DE ESCAPE SUPER SEGURA PARA SVG
          svg_escape() {
            echo "$1" | sed \
              -e 's/&/\&amp;/g' \
              -e 's/</\&lt;/g' \
              -e 's/>/\&gt;/g' \
              -e 's/"/\&quot;/g' \
              -e "s/'/\&apos;/g" \
              -e 's/\\//g' \
              -e 's/\`//g' \
              -e 's/\$//g' \
              -e 's/\*//g' \
              -e 's/#//g' \
              -e 's/|//g' \
              -e 's/\^//g' \
              -e 's/~//g' \
              -e 's/\x0//g' | tr -d '\n\r\t' | head -c 80
          }
          
          # Escapar TODAS as strings para SVG
          CHAR_NAME_ESC=$(svg_escape "$CHARACTER_NAME")
          CHAR_CLASS_ESC=$(svg_escape "$CHARACTER_CLASS")
          ELEMENT_ESC=$(svg_escape "$ELEMENT")
          REGION_ESC=$(svg_escape "$REGION")
          WEAPON_ESC=$(svg_escape "$WEAPON_TYPE")
          SKILL_ESC=$(svg_escape "$SPECIAL_SKILL")
          PLAYSTYLE_ESC=$(svg_escape "$PLAYSTYLE")
          BIO_ESC=$(svg_escape "$USER_BIO")
          PROJECT1_NAME_ESC=$(svg_escape "$PROJECT1_NAME")
          PROJECT1_LANG_ESC=$(svg_escape "$PROJECT1_LANG")
          PROJECT2_NAME_ESC=$(svg_escape "$PROJECT2_NAME")
          PROJECT2_LANG_ESC=$(svg_escape "$PROJECT2_LANG")
          PROJECT3_NAME_ESC=$(svg_escape "$PROJECT3_NAME")
          PROJECT3_LANG_ESC=$(svg_escape "$PROJECT3_LANG")
          
          # Cores baseadas no rank
          case "$RANK" in
            "S") RANK_COLOR="#FFD700"; RANK_GLOW="#FFA500" ;;
            "A+") RANK_COLOR="#FF6B6B"; RANK_GLOW="#FF3333" ;;
            "A") RANK_COLOR="#FF8E8E"; RANK_GLOW="#FF6B6B" ;;
            "B+") RANK_COLOR="#4ECDC4"; RANK_GLOW="#26A69A" ;;
            "B") RANK_COLOR="#95E1D3"; RANK_GLOW="#4ECDC4" ;;
            "C+") RANK_COLOR="#FFD166"; RANK_GLOW="#FFB347" ;;
            "C") RANK_COLOR="#FFE8A0"; RANK_GLOW="#FFD166" ;;
            "D") RANK_COLOR="#A0A0A0"; RANK_GLOW="#808080" ;;
            *) RANK_COLOR="#808080"; RANK_GLOW="#606060" ;;
          esac
          
          # Calcular largura da barra de XP (garantir entre 0-350)
          BAR_WIDTH=$((350 * XP_PERCENT / 100))
          if [ $BAR_WIDTH -gt 350 ]; then BAR_WIDTH=350; fi
          if [ $BAR_WIDTH -lt 0 ]; then BAR_WIDTH=0; fi
          
          # Garantir que o XP_PERCENT seja entre 0-100
          if [ $XP_PERCENT -gt 100 ]; then XP_PERCENT=100; fi
          if [ $XP_PERCENT -lt 0 ]; then XP_PERCENT=0; fi
          
          # Criar SVG com TODOS os escapes e fallbacks
          cat > "$SVG_FILE" << 'EOF'
          <svg xmlns="http://www.w3.org/2000/svg" width="600" height="800" viewBox="0 0 600 800">
          <defs>
            <style>
              /* Fontes seguras - sempre funcionam */
              .title-text {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 32px;
                font-weight: 700;
                fill: white;
                text-shadow: 0 0 10px 
EOF
          
          # Inserir cor do elemento
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
                , 0 0 20px 
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
                ;
                letter-spacing: 1px;
              }
              
              .subtitle-text {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 18px;
                font-weight: 500;
                fill: #E0E0FF;
                letter-spacing: 0.5px;
              }
              
              .stat-label {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 14px;
                font-weight: 400;
                fill: #B0B0D0;
                text-transform: uppercase;
                letter-spacing: 1px;
              }
              
              .stat-value {
                font-family: 'Courier New', 'Monaco', monospace;
                font-size: 16px;
                font-weight: 700;
                fill: white;
              }
              
              .rank-text {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 48px;
                font-weight: 900;
                fill: 
EOF
          
          echo "$RANK_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
                ;
                text-shadow: 0 0 15px 
EOF
          
          echo "$RANK_GLOW" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
                , 0 0 30px 
EOF
          
          echo "$RANK_GLOW" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
                ;
              }
              
              .level-text {
                font-family: 'Courier New', 'Monaco', monospace;
                font-size: 28px;
                font-weight: 900;
                fill: white;
                text-shadow: 0 0 10px 
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
                ;
              }
              
              .xp-text {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 12px;
                fill: #D0D0FF;
              }
              
              .project-text {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 11px;
                fill: #C0C0E0;
              }
              
              .project-title {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 13px;
                font-weight: 600;
                fill: white;
              }
              
              .bio-text {
                font-family: 'Arial', 'Helvetica', sans-serif;
                font-size: 12px;
                fill: #D0D0FF;
                line-height: 1.4;
              }
            </style>
            
            <!-- Gradientes -->
            <linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#0A0A1A"/>
              <stop offset="50%" stop-color="#1A1A2E"/>
              <stop offset="100%" stop-color="#0A0A1A"/>
            </linearGradient>
            
            <linearGradient id="elementGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              "/>
              <stop offset="50%" stop-color="#FFFFFF"/>
              <stop offset="100%" stop-color="
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              "/>
            </linearGradient>
            
            <linearGradient id="xpBarGradient" x1="0%" y1="0%" x2="100%" y2="0%">
              <stop offset="0%" stop-color="#FFD700"/>
              <stop offset="50%" stop-color="#FFA500"/>
              <stop offset="100%" stop-color="#FFD700"/>
            </linearGradient>
            
            <linearGradient id="cardGradient" x1="0%" y1="0%" x2="100%" y2="100%">
              <stop offset="0%" stop-color="#1E1E2E" stop-opacity="0.9"/>
              <stop offset="100%" stop-color="#2D2D44" stop-opacity="0.9"/>
            </linearGradient>
          </defs>
          
          <!-- Fundo -->
          <rect width="600" height="800" fill="url(#bgGradient)"/>
          
          <!-- Card principal -->
          <rect x="30" y="30" width="540" height="740" rx="25" fill="url(#cardGradient)" stroke="
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
          " stroke-width="2" opacity="0.95"/>
          
          <!-- Cabe√ßalho -->
          <rect x="30" y="30" width="540" height="100" rx="25" fill="
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
          " opacity="0.3"/>
          
          <!-- Nome -->
          <text x="300" y="85" text-anchor="middle" class="title-text">
EOF
          
          echo "$CHAR_NAME_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
          </text>
          
          <!-- Classe e Elemento -->
          <text x="300" y="115" text-anchor="middle" class="subtitle-text">
EOF
          
          echo "$CHAR_CLASS_ESC ‚Ä¢ $ELEMENT_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
          </text>
          
          <!-- N√≠vel e Rank -->
          <g transform="translate(50, 160)">
            <!-- N√≠vel -->
            <rect x="0" y="0" width="150" height="60" rx="15" fill="#2A2A3A" opacity="0.8"/>
            <text x="75" y="25" text-anchor="middle" class="stat-label">N√çVEL</text>
            <text x="75" y="50" text-anchor="middle" class="level-text">
EOF
          
          echo "$LEVEL" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
            
            <!-- Rank -->
            <rect x="180" y="0" width="150" height="60" rx="15" fill="#2A2A3A" opacity="0.8"/>
            <text x="255" y="25" text-anchor="middle" class="stat-label">RANK</text>
            <text x="255" y="55" text-anchor="middle" class="rank-text">
EOF
          
          echo "$RANK" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
            
            <!-- XP Total -->
            <rect x="360" y="0" width="150" height="60" rx="15" fill="#2A2A3A" opacity="0.8"/>
            <text x="435" y="25" text-anchor="middle" class="stat-label">XP TOTAL</text>
            <text x="435" y="50" text-anchor="middle" class="stat-value">
EOF
          
          echo "$TOTAL_XP" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
          </g>
          
          <!-- Barra de XP -->
          <g transform="translate(50, 240)">
            <text x="0" y="0" class="stat-label">EXPERI√äNCIA</text>
            <text x="400" y="0" class="xp-text" text-anchor="end">
EOF
          
          echo "$XP_PERCENT% para o pr√≥ximo n√≠vel" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
            
            <!-- Barra de fundo -->
            <rect x="0" y="20" width="400" height="20" rx="10" fill="#1A1A2A"/>
            
            <!-- Barra de XP preenchida -->
            <rect x="0" y="20" width="
EOF
          
          echo "$BAR_WIDTH" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            " height="20" rx="10" fill="url(#xpBarGradient)"/>
          </g>
          
          <!-- Stats do GitHub -->
          <g transform="translate(50, 300)">
            <text x="0" y="0" class="stat-label">STATS DO GITHUB</text>
            
            <g transform="translate(0, 30)">
              <!-- Reposit√≥rios -->
              <rect x="0" y="0" width="160" height="70" rx="15" fill="#252535" opacity="0.8"/>
              <text x="80" y="25" text-anchor="middle" class="stat-label">Reposit√≥rios</text>
              <text x="80" y="50" text-anchor="middle" class="stat-value">
EOF
          
          echo "$PUBLIC_REPOS" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Seguidores -->
              <rect x="180" y="0" width="160" height="70" rx="15" fill="#252535" opacity="0.8"/>
              <text x="260" y="25" text-anchor="middle" class="stat-label">Seguidores</text>
              <text x="260" y="50" text-anchor="middle" class="stat-value">
EOF
          
          echo "$FOLLOWERS" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Estrelas -->
              <rect x="360" y="0" width="160" height="70" rx="15" fill="#252535" opacity="0.8"/>
              <text x="440" y="25" text-anchor="middle" class="stat-label">Estrelas</text>
              <text x="440" y="50" text-anchor="middle" class="stat-value">
EOF
          
          echo "$STARS_TOTAL" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
            </g>
          </g>
          
          <!-- Informa√ß√µes -->
          <g transform="translate(50, 400)">
            <text x="0" y="0" class="stat-label">INFORMA√á√ïES</text>
            
            <g transform="translate(0, 30)">
              <!-- Regi√£o -->
              <rect x="0" y="0" width="250" height="40" rx="10" fill="#2A2A3A" opacity="0.7"/>
              <text x="15" y="15" class="stat-label" font-size="12">üè∞ Regi√£o</text>
              <text x="15" y="30" class="stat-value" font-size="14">
EOF
          
          echo "$REGION_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Arma -->
              <rect x="270" y="0" width="250" height="40" rx="10" fill="#2A2A3A" opacity="0.7"/>
              <text x="285" y="15" class="stat-label" font-size="12">‚öîÔ∏è Arma</text>
              <text x="285" y="30" class="stat-value" font-size="14">
EOF
          
          echo "$WEAPON_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Estilo -->
              <rect x="0" y="50" width="250" height="40" rx="10" fill="#2A2A3A" opacity="0.7"/>
              <text x="15" y="65" class="stat-label" font-size="12">üé≠ Estilo</text>
              <text x="15" y="80" class="stat-value" font-size="14">
EOF
          
          echo "$PLAYSTYLE_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Habilidade -->
              <rect x="270" y="50" width="250" height="40" rx="10" fill="#2A2A3A" opacity="0.7"/>
              <text x="285" y="65" class="stat-label" font-size="12">‚ú® Habilidade</text>
              <text x="285" y="80" class="stat-value" font-size="14">
EOF
          
          echo "$SKILL_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
            </g>
          </g>
          
          <!-- Bio -->
          <g transform="translate(50, 500)">
            <rect x="0" y="0" width="500" height="60" rx="10" fill="#2A2A3A" opacity="0.7"/>
            <text x="15" y="20" class="stat-label">üìñ BIOGRAFIA</text>
            <text x="15" y="40" class="bio-text">
EOF
          
          echo "$BIO_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
          </g>
          
          <!-- Projetos -->
          <g transform="translate(50, 580)">
            <text x="0" y="0" class="stat-label">PROJETOS DESTAQUES</text>
            
            <g transform="translate(0, 30)">
              <!-- Projeto 1 -->
              <rect x="0" y="0" width="160" height="80" rx="15" fill="#252535" opacity="0.8"/>
              <text x="80" y="20" text-anchor="middle" class="project-title">
EOF
          
          echo "$PROJECT1_NAME_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              <text x="80" y="35" text-anchor="middle" class="project-text">‚≠ê 
EOF
          
          echo "$PROJECT1_STARS estrelas" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              <text x="80" y="50" text-anchor="middle" class="project-text">üîß 
EOF
          
          echo "$PROJECT1_LANG_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Projeto 2 -->
              <rect x="180" y="0" width="160" height="80" rx="15" fill="#252535" opacity="0.8"/>
              <text x="260" y="20" text-anchor="middle" class="project-title">
EOF
          
          echo "$PROJECT2_NAME_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              <text x="260" y="35" text-anchor="middle" class="project-text">‚≠ê 
EOF
          
          echo "$PROJECT2_STARS estrelas" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              <text x="260" y="50" text-anchor="middle" class="project-text">üîß 
EOF
          
          echo "$PROJECT2_LANG_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              
              <!-- Projeto 3 -->
              <rect x="360" y="0" width="160" height="80" rx="15" fill="#252535" opacity="0.8"/>
              <text x="440" y="20" text-anchor="middle" class="project-title">
EOF
          
          echo "$PROJECT3_NAME_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              <text x="440" y="35" text-anchor="middle" class="project-text">‚≠ê 
EOF
          
          echo "$PROJECT3_STARS estrelas" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
              <text x="440" y="50" text-anchor="middle" class="project-text">üîß 
EOF
          
          echo "$PROJECT3_LANG_ESC" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
              </text>
            </g>
          </g>
          
          <!-- Footer -->
          <g transform="translate(50, 690)">
            <rect x="0" y="0" width="500" height="40" rx="10" fill="#1A1A2A" opacity="0.8"/>
            <text x="15" y="25" class="project-text">üéÆ Genshin Dev Card ‚Ä¢ 
EOF
          
          echo "$DATE $TIME" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
            <text x="485" y="25" class="project-text" text-anchor="end">N√≠vel 
EOF
          
          echo "$LEVEL ‚Ä¢ Rank $RANK" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
            </text>
          </g>
          
          <!-- Decora√ß√£o simples -->
          <circle cx="550" cy="150" r="3" fill="
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
          " opacity="0.7"/>
          <circle cx="50" cy="250" r="3" fill="
EOF
          
          echo "$ELEMENT_COLOR" >> "$SVG_FILE"
          
          cat >> "$SVG_FILE" << 'EOF'
          " opacity="0.7"/>
          
          </svg>
EOF
          
          echo "‚ú®‚úÖ Card Genshin criado COM SUCESSO: $SVG_FILE"
          echo "üéÆ Estilo: Genshin Impact"
          echo "‚öîÔ∏è N√≠vel: $LEVEL"
          echo "‚≠ê Rank: $RANK"
          echo "üìà XP: $TOTAL_XP ($XP_PERCENT% progresso)"
          echo "üî• Elemento: $ELEMENT"
          echo "‚úÖ SVG gerado sem erros!"
      
      - name: üì§ Salvar card
        run: |
          git config user.name "github-actions"
          git config user.email "github-actions@github.com"
          
          git add cards/
          git commit -m "‚öîÔ∏è Add Genshin card: ${{ github.event.inputs.github_user }} (N√≠vel ${{ steps.github-data.outputs.level }})" || echo "Sem altera√ß√µes"
          git push
          echo "‚úÖ Workflow completo!"
