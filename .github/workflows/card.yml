name: "üéÆ METRO GOTHIC XP CARD"

on:
  workflow_dispatch:
    inputs:
      github_user:
        description: 'üë§ Usu√°rio do GitHub'
        required: true
        default: 'ciconha'
      player_name:
        description: 'üé≠ Nome do Personagem'
        required: false
        default: 'NEO-METRO RIDER'
      
      # üèÜ SISTEMA DE CLASSE
      class_type:
        description: '‚öîÔ∏è Escolha sua Classe'
        required: false
        default: 'CYBER-MAGE'
        type: choice
        options:
        - CYBER-MAGE
        - NEURAL-HUNTER
        - QUANTUM-TANK
        - VOID-ROGUE
        - DATA-PALADIN
        - CHAOS-SORCERER
        - TECH-PRIEST
        - DIGITAL-NINJA
      
      # üé≠ ALINHAMENTO
      alignment:
        description: '‚öñÔ∏è Alinhamento Moral'
        required: false
        default: 'NEUTRAL'
        type: choice
        options:
        - LAWFUL_GOOD
        - NEUTRAL_GOOD
        - CHAOTIC_GOOD
        - LAWFUL_NEUTRAL
        - TRUE_NEUTRAL
        - CHAOTIC_NEUTRAL
        - LAWFUL_EVIL
        - NEUTRAL_EVIL
        - CHAOTIC_EVIL
      
      # üé® CUSTOMIZA√á√ÉO VISUAL
      theme:
        description: 'üé® Tema de Cores'
        required: false
        default: 'CYBERPUNK'
        type: choice
        options:
        - CYBERPUNK
        - MATRIX
        - SYNTHWAVE
        - VAPORWAVE
        - TERMINAL
        - RETRO
        - MONOCHROME
        - CUSTOM
      
      # üé® CORES PERSONALIZADAS (se CUSTOM)
      primary_color:
        description: 'üî¥ Cor Prim√°ria (hex: #FF0000)'
        required: false
        default: '#00FFAA'
      secondary_color:
        description: 'üü¢ Cor Secund√°ria (hex: #00FF00)'
        required: false
        default: '#FF00FF'
      accent_color:
        description: 'üîµ Cor de Destaque (hex: #0000FF)'
        required: false
        default: '#00FFFF'
      background_color:
        description: '‚ö´ Cor de Fundo (hex: #0A0A0A)'
        required: false
        default: '#0A0A0A'
      
      # üìä ESTILO DE BARRAS
      bar_style:
        description: 'üìä Estilo da Barra de XP'
        required: false
        default: 'NEON'
        type: choice
        options:
        - NEON
        - GLITCH
        - CIRCUIT
        - PULSE
        - WAVE
        - BINARY
        - MATRIX
      
      # üí´ EFEITOS ESPECIAIS
      effects:
        description: '‚ú® Efeitos Visuais'
        required: false
        default: 'GLOW'
        type: multiple
        options:
        - GLOW
        - SCAN_LINES
        - PIXEL_DUST
        - DATA_STREAM
        - HOLOGRAM
        - RAIN
        - STATIC
      
      # üîß CONFIGURA√á√ïES T√âCNICAS
      difficulty:
        description: '‚öôÔ∏è N√≠vel de Dificuldade'
        required: false
        default: 'NORMAL'
        type: choice
        options:
        - EASY
        - NORMAL
        - HARD
        - INSANE
        - ULTIMATE

permissions:
  contents: write

jobs:
  create-metro-card:
    runs-on: ubuntu-latest
    
    steps:
      - name: üèóÔ∏è CHECKOUT DIMENSIONAL
        uses: actions/checkout@v4
        
      - name: ‚öôÔ∏è INSTALAR N√öCLEOS
        run: |
          sudo apt-get update -y
          sudo apt-get install -y curl jq bc imagemagick
          echo "‚úÖ N√∫cleos instalados"
      
      - name: üîÆ SCAN MATRIX GITHUB
        id: scan-matrix
        env:
          GH_TOKEN: ${{ github.token }}
        run: |
          USER="${{ inputs.github_user || github.event.inputs.github_user }}"
          echo "üîç SCANEANDO MATRIX: $USER"
          
          # API do GitHub
          curl -s -H "Authorization: token $GH_TOKEN" \
               "https://api.github.com/users/$USER" > user.json
          curl -s -H "Authorization: token $GH_TOKEN" \
               "https://api.github.com/users/$USER/repos?per_page=100" > repos.json
          curl -s -H "Authorization: token $GH_TOKEN" \
               "https://api.github.com/users/$USER/events?per_page=100" > events.json
          
          # Dados b√°sicos
          AVATAR_URL=$(jq -r '.avatar_url' user.json | sed 's/\?v=.*//')
          AVATAR_URL="${AVATAR_URL}?size=200"
          BIO=$(jq -r '.bio // "Digital entity in the Metro network."' user.json)
          
          # Stats
          PUBLIC_REPOS=$(jq -r '.public_repos // 0' user.json)
          FOLLOWERS=$(jq -r '.followers // 0' user.json)
          FOLLOWING=$(jq -r '.following // 0' user.json)
          
          # Estrelas e forks
          TOTAL_STARS=$(jq '[.[].stargazers_count // 0] | add' repos.json 2>/dev/null || echo "0")
          TOTAL_FORKS=$(jq '[.[].forks_count // 0] | add' repos.json 2>/dev/null || echo "0")
          
          # Atividade
          COMMITS=$(jq '[.[] | select(.type == "PushEvent")] | length' events.json 2>/dev/null || echo "0")
          PRS=$(jq '[.[] | select(.type == "PullRequestEvent")] | length' events.json 2>/dev/null || echo "0")
          ISSUES=$(jq '[.[] | select(.type == "IssuesEvent")] | length' events.json 2>/dev/null || echo "0")
          
          # Top 4 projetos
          jq '[.[] | sort_by(-.stargazers_count) | .[0:4] | .[] | {name: (.name // "VOID"), stars: (.stargazers_count // 0), forks: (.forks_count // 0), language: (.language // "BINARY")}]' \
             repos.json > top_projects.json 2>/dev/null || echo '[]' > top_projects.json
          
          # üéÆ SISTEMA DE XP METRO GOTHIC
          XP_REPO=$((PUBLIC_REPOS * 150))
          XP_FOLLOWER=$((FOLLOWERS * 75))
          XP_STARS=$((TOTAL_STARS * 25))
          XP_FORKS=$((TOTAL_FORKS * 15))
          XP_COMMITS=$((COMMITS * 5))
          XP_PRS=$((PRS * 20))
          XP_ISSUES=$((ISSUES * 10))
          
          TOTAL_XP=$((XP_REPO + XP_FOLLOWER + XP_STARS + XP_FORKS + XP_COMMITS + XP_PRS + XP_ISSUES))
          [ $TOTAL_XP -lt 1000 ] && TOTAL_XP=1000
          
          # üèÜ SISTEMA DE N√çVEL (logar√≠tmico)
          if [ $TOTAL_XP -gt 0 ]; then
            XP_RATIO=$(echo "scale=10; $TOTAL_XP / 1000" | bc)
            LOG_RATIO=$(echo "l($XP_RATIO + 1) / l(2)" | bc -l)
            LEVEL=$(printf "%.0f" "$LOG_RATIO")
            LEVEL=$((LEVEL + 1))
          else
            LEVEL=1
          fi
          
          [ $LEVEL -lt 1 ] && LEVEL=1
          [ $LEVEL -gt 999 ] && LEVEL=999
          
          # üìä BARRA DE XP
          XP_NEEDED=$((1000 * (2 ** (LEVEL - 1))))
          XP_CURRENT=$((TOTAL_XP % XP_NEEDED))
          XP_PERCENT=$((XP_CURRENT * 100 / XP_NEEDED))
          
          # üèÖ SISTEMA DE RANKING
          RANK_SCORE=$((LEVEL * 10 + PUBLIC_REPOS + FOLLOWERS / 10 + TOTAL_STARS / 100))
          
          if [ $RANK_SCORE -ge 10000 ]; then RANK="Œ©"
          elif [ $RANK_SCORE -ge 8000 ]; then RANK="Œ£"
          elif [ $RANK_SCORE -ge 6000 ]; then RANK="Œî"
          elif [ $RANK_SCORE -ge 4000 ]; then RANK="Œì"
          elif [ $RANK_SCORE -ge 2000 ]; then RANK="Œí"
          elif [ $RANK_SCORE -ge 1000 ]; then RANK="Œë"
          elif [ $RANK_SCORE -ge 500 ]; then RANK="S"
          elif [ $RANK_SCORE -ge 250 ]; then RANK="A"
          elif [ $RANK_SCORE -ge 100 ]; then RANK="B"
          elif [ $RANK_SCORE -ge 50 ]; then RANK="C"
          elif [ $RANK_SCORE -ge 20 ]; then RANK="D"
          else RANK="E"
          fi
          
          # üé® CORES BASEADO NO RANK
          case "$RANK" in
            "Œ©") RANK_COLOR="#FF00FF"; RANK_GLOW="#FF00FF" ;;
            "Œ£") RANK_COLOR="#00FFFF"; RANK_GLOW="#00FFFF" ;;
            "Œî") RANK_COLOR="#FFFF00"; RANK_GLOW="#FFFF00" ;;
            "Œì") RANK_COLOR="#00FF00"; RANK_GLOW="#00FF00" ;;
            "Œí") RANK_COLOR="#FF4500"; RANK_GLOW="#FF4500" ;;
            "Œë") RANK_COLOR="#FF0000"; RANK_GLOW="#FF0000" ;;
            "S") RANK_COLOR="#FFD700"; RANK_GLOW="#FFA500" ;;
            "A") RANK_COLOR="#FF6B6B"; RANK_GLOW="#FF3333" ;;
            "B") RANK_COLOR="#4ECDC4"; RANK_GLOW="#26A69A" ;;
            "C") RANK_COLOR="#FFD166"; RANK_GLOW="#FFB347" ;;
            "D") RANK_COLOR="#A0A0A0"; RANK_GLOW="#808080" ;;
            *)   RANK_COLOR="#606060"; RANK_GLOW="#404040" ;;
          esac
          
          # üé≠ CLASSES E ATRIBUTOS
          CLASS="${{ github.event.inputs.class_type || 'CYBER-MAGE' }}"
          
          case "$CLASS" in
            "CYBER-MAGE")
              ATK=65; DEF=45; INT=90; SPD=70; HP=550; MP=850
              CLASS_COLOR="#8A2BE2"; SKILLS="Quantum Hack | Neural Overload | Data Storm"
              ;;
            "NEURAL-HUNTER")
              ATK=85; DEF=60; INT=75; SPD=90; HP=650; MP=500
              CLASS_COLOR="#00CED1"; SKILLS="Precision Strike | Ghost Protocol | Hunter's Mark"
              ;;
            "QUANTUM-TANK")
              ATK=70; DEF=95; INT=50; SPD=40; HP=950; MP=300
              CLASS_COLOR="#228B22"; SKILLS="Force Field | Quantum Shield | Bulwark"
              ;;
            "VOID-ROGUE")
              ATK=90; DEF=55; INT=65; SPD=95; HP=500; MP=600
              CLASS_COLOR="#4B0082"; SKILLS="Shadow Step | Silent Kill | Vanish"
              ;;
            "DATA-PALADIN")
              ATK=80; DEF=85; INT=70; SPD=55; HP=800; MP=650
              CLASS_COLOR="#FFD700"; SKILLS="Divine Smite | Holy Fire | Sanctuary"
              ;;
            "CHAOS-SORCERER")
              ATK=60; DEF=40; INT=95; SPD=65; HP=450; MP=900
              CLASS_COLOR="#FF4500"; SKILLS="Chaos Bolt | Reality Warp | Entropy Field"
              ;;
            "TECH-PRIEST")
              ATK=55; DEF=75; INT=85; SPD=50; HP=700; MP=750
              CLASS_COLOR="#20B2AA"; SKILLS="System Bless | Machine Spirit | Technomancy"
              ;;
            "DIGITAL-NINJA")
              ATK=95; DEF=50; INT=60; SPD=100; HP=480; MP=550
              CLASS_COLOR="#696969"; SKILLS="Digital Clone | Silent Run | Blade Storm"
              ;;
            *)
              ATK=70; DEF=60; INT=70; SPD=70; HP=600; MP=600
              CLASS_COLOR="#666666"; SKILLS="Basic Attack | Guard | Heal"
              ;;
          esac
          
          # üé® TEMAS DE CORES
          THEME="${{ github.event.inputs.theme || 'CYBERPUNK' }}"
          
          case "$THEME" in
            "CYBERPUNK")
              PRIMARY="#00FFAA"; SECONDARY="#FF00FF"; ACCENT="#00FFFF"; BG="#0A0A0A"
              ;;
            "MATRIX")
              PRIMARY="#00FF00"; SECONDARY="#00CC00"; ACCENT="#009900"; BG="#000000"
              ;;
            "SYNTHWAVE")
              PRIMARY="#FF00FF"; SECONDARY="#FF0099"; ACCENT="#00FFFF"; BG="#0A0022"
              ;;
            "VAPORWAVE")
              PRIMARY="#FF71CE"; SECONDARY="#01CDFE"; ACCENT="#05FFA1"; BG="#000000"
              ;;
            "TERMINAL")
              PRIMARY="#00FF00"; SECONDARY="#00AA00"; ACCENT="#008800"; BG="#000000"
              ;;
            "RETRO")
              PRIMARY="#FF6B6B"; SECONDARY="#4ECDC4"; ACCENT="#FFD166"; BG="#1A1A2E"
              ;;
            "MONOCHROME")
              PRIMARY="#FFFFFF"; SECONDARY="#CCCCCC"; ACCENT="#999999"; BG="#000000"
              ;;
            "CUSTOM")
              PRIMARY="${{ github.event.inputs.primary_color || '#00FFAA' }}"
              SECONDARY="${{ github.event.inputs.secondary_color || '#FF00FF' }}"
              ACCENT="${{ github.event.inputs.accent_color || '#00FFFF' }}"
              BG="${{ github.event.inputs.background_color || '#0A0A0A' }}"
              ;;
            *)
              PRIMARY="#00FFAA"; SECONDARY="#FF00FF"; ACCENT="#00FFFF"; BG="#0A0A0A"
              ;;
          esac
          
          # üìä ESTRAT√âGIAS DE BARRA
          BAR_STYLE="${{ github.event.inputs.bar_style || 'NEON' }}"
          
          # Outputs
          echo "avatar_url=$AVATAR_URL" >> $GITHUB_OUTPUT
          echo "bio=$BIO" >> $GITHUB_OUTPUT
          echo "public_repos=$PUBLIC_REPOS" >> $GITHUB_OUTPUT
          echo "followers=$FOLLOWERS" >> $GITHUB_OUTPUT
          echo "total_stars=$TOTAL_STARS" >> $GITHUB_OUTPUT
          echo "total_forks=$TOTAL_FORKS" >> $GITHUB_OUTPUT
          echo "commits=$COMMITS" >> $GITHUB_OUTPUT
          echo "prs=$PRS" >> $GITHUB_OUTPUT
          echo "issues=$ISSUES" >> $GITHUB_OUTPUT
          echo "total_xp=$TOTAL_XP" >> $GITHUB_OUTPUT
          echo "level=$LEVEL" >> $GITHUB_OUTPUT
          echo "xp_percent=$XP_PERCENT" >> $GITHUB_OUTPUT
          echo "xp_current=$XP_CURRENT" >> $GITHUB_OUTPUT
          echo "xp_needed=$XP_NEEDED" >> $GITHUB_OUTPUT
          echo "rank=$RANK" >> $GITHUB_OUTPUT
          echo "rank_color=$RANK_COLOR" >> $GITHUB_OUTPUT
          echo "rank_glow=$RANK_GLOW" >> $GITHUB_OUTPUT
          echo "class=$CLASS" >> $GITHUB_OUTPUT
          echo "class_color=$CLASS_COLOR" >> $GITHUB_OUTPUT
          echo "skills=$SKILLS" >> $GITHUB_OUTPUT
          echo "atk=$ATK" >> $GITHUB_OUTPUT
          echo "def=$DEF" >> $GITHUB_OUTPUT
          echo "int=$INT" >> $GITHUB_OUTPUT
          echo "spd=$SPD" >> $GITHUB_OUTPUT
          echo "hp=$HP" >> $GITHUB_OUTPUT
          echo "mp=$MP" >> $GITHUB_OUTPUT
          echo "primary_color=$PRIMARY" >> $GITHUB_OUTPUT
          echo "secondary_color=$SECONDARY" >> $GITHUB_OUTPUT
          echo "accent_color=$ACCENT" >> $GITHUB_OUTPUT
          echo "background_color=$BG" >> $GITHUB_OUTPUT
          echo "bar_style=$BAR_STYLE" >> $GITHUB_OUTPUT
          echo "alignment=${{ github.event.inputs.alignment || 'NEUTRAL' }}" >> $GITHUB_OUTPUT
          echo "difficulty=${{ github.event.inputs.difficulty || 'NORMAL' }}" >> $GITHUB_OUTPUT
          
          echo "‚úÖ MATRIX SCAN COMPLETO"
          echo "üéÆ Classe: $CLASS"
          echo "üèÜ N√≠vel: $LEVEL | Rank: $RANK"
          echo "‚öîÔ∏è ATK: $ATK | üõ°Ô∏è DEF: $DEF | üß† INT: $INT | ‚ö° SPD: $SPD"
          echo "‚ù§Ô∏è HP: $HP | üíô MP: $MP"
      
      - name: üé® GERAR CARD METRO GOTHIC
        run: |
          # Carregar todas as vari√°veis
          AVATAR_URL="${{ steps.scan-matrix.outputs.avatar_url }}"
          BIO="${{ steps.scan-matrix.outputs.bio }}"
          PUBLIC_REPOS="${{ steps.scan-matrix.outputs.public_repos }}"
          FOLLOWERS="${{ steps.scan-matrix.outputs.followers }}"
          TOTAL_STARS="${{ steps.scan-matrix.outputs.total_stars }}"
          TOTAL_FORKS="${{ steps.scan-matrix.outputs.total_forks }}"
          COMMITS="${{ steps.scan-matrix.outputs.commits }}"
          PRS="${{ steps.scan-matrix.outputs.prs }}"
          ISSUES="${{ steps.scan-matrix.outputs.issues }}"
          TOTAL_XP="${{ steps.scan-matrix.outputs.total_xp }}"
          LEVEL="${{ steps.scan-matrix.outputs.level }}"
          XP_PERCENT="${{ steps.scan-matrix.outputs.xp_percent }}"
          XP_CURRENT="${{ steps.scan-matrix.outputs.xp_current }}"
          XP_NEEDED="${{ steps.scan-matrix.outputs.xp_needed }}"
          RANK="${{ steps.scan-matrix.outputs.rank }}"
          RANK_COLOR="${{ steps.scan-matrix.outputs.rank_color }}"
          RANK_GLOW="${{ steps.scan-matrix.outputs.rank_glow }}"
          CLASS="${{ steps.scan-matrix.outputs.class }}"
          CLASS_COLOR="${{ steps.scan-matrix.outputs.class_color }}"
          SKILLS="${{ steps.scan-matrix.outputs.skills }}"
          ATK="${{ steps.scan-matrix.outputs.atk }}"
          DEF="${{ steps.scan-matrix.outputs.def }}"
          INT="${{ steps.scan-matrix.outputs.int }}"
          SPD="${{ steps.scan-matrix.outputs.spd }}"
          HP="${{ steps.scan-matrix.outputs.hp }}"
          MP="${{ steps.scan-matrix.outputs.mp }}"
          PRIMARY="${{ steps.scan-matrix.outputs.primary_color }}"
          SECONDARY="${{ steps.scan-matrix.outputs.secondary_color }}"
          ACCENT="${{ steps.scan-matrix.outputs.accent_color }}"
          BACKGROUND="${{ steps.scan-matrix.outputs.background_color }}"
          BAR_STYLE="${{ steps.scan-matrix.outputs.bar_style }}"
          ALIGNMENT="${{ steps.scan-matrix.outputs.alignment }}"
          DIFFICULTY="${{ steps.scan-matrix.outputs.difficulty }}"
          
          # Input do usu√°rio
          PLAYER_NAME="${{ github.event.inputs.player_name }}"
          if [ -z "$PLAYER_NAME" ] || [ "$PLAYER_NAME" = "null" ]; then
            PLAYER_NAME="${{ github.event.inputs.github_user }}"
          fi
          
          # Efeitos especiais
          EFFECTS="${{ github.event.inputs.effects || 'GLOW' }}"
          
          # Data e hora
          MATRIX_DATE=$(date +'%Y.%m.%d')
          MATRIX_TIME=$(date +'%H:%M:%S')
          UNIX_TIME=$(date +%s)
          
          # Projetos top
          PROJECT1_NAME=$(jq -r '.[0].name // "VOID-CORE"' top_projects.json 2>/dev/null | head -c 15)
          PROJECT1_STARS=$(jq -r '.[0].stars // 0' top_projects.json 2>/dev/null)
          PROJECT1_LANG=$(jq -r '.[0].language // "BINARY"' top_projects.json 2>/dev/null | head -c 10)
          
          PROJECT2_NAME=$(jq -r '.[1].name // "NEURAL-NET"' top_projects.json 2>/dev/null | head -c 15)
          PROJECT2_STARS=$(jq -r '.[1].stars // 0' top_projects.json 2>/dev/null)
          PROJECT2_LANG=$(jq -r '.[1].language // "SYNTAX"' top_projects.json 2>/dev/null | head -c 10)
          
          PROJECT3_NAME=$(jq -r '.[2].name // "QUANTUM-DB"' top_projects.json 2>/dev/null | head -c 15)
          PROJECT3_STARS=$(jq -r '.[2].stars // 0' top_projects.json 2>/dev/null)
          PROJECT3_LANG=$(jq -r '.[2].language // "QUERY"' top_projects.json 2>/dev/null | head -c 10)
          
          # C√°lculos de barras
          BAR_XP_WIDTH=$((400 * XP_PERCENT / 100))
          BAR_HP_WIDTH=$((100 * HP / 1000))
          BAR_MP_WIDTH=$((100 * MP / 1000))
          BAR_ATK_WIDTH=$ATK
          BAR_DEF_WIDTH=$DEF
          BAR_INT_WIDTH=$INT
          BAR_SPD_WIDTH=$SPD
          
          # Nome do arquivo
          SAFE_NAME=$(echo "$PLAYER_NAME" | tr ' ' '_' | tr -cd '[:alnum:]_-')
          [ -z "$SAFE_NAME" ] && SAFE_NAME="metro_card"
          SVG_FILE="cards/${SAFE_NAME}_${UNIX_TIME}.svg"
          
          # Fun√ß√£o de escape
          escape_svg() {
            echo "$1" | sed \
              -e 's/&/\&amp;/g' \
              -e 's/</\&lt;/g' \
              -e 's/>/\&gt;/g' \
              -e 's/"/\&quot;/g' \
              -e "s/'/\&apos;/g" \
              -e 's/\\n/ /g' | tr -d '\n\r' | head -c 100
          }
          
          # Escapar textos
          PLAYER_ESC=$(escape_svg "$PLAYER_NAME")
          BIO_ESC=$(escape_svg "$BIO")
          SKILLS_ESC=$(escape_svg "$SKILLS")
          
          # Criar diret√≥rio
          mkdir -p cards
          
          # GERAR SVG METRO GOTHIC
          cat > "$SVG_FILE" << 'EOF'
<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" width="900" height="500" viewBox="0 0 900 500">
<defs>
EOF
          
          # Adicionar estilos dinamicamente
          cat >> "$SVG_FILE" << EOF
<style>
@import url('https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700;800;900&family=Rajdhani:wght@300;400;500;600;700&family=Share+Tech+Mono&display=swap');

.title-main { font-family: 'Orbitron', sans-serif; font-size: 32px; font-weight: 900; fill: $PRIMARY; letter-spacing: 1px; }
.class-name { font-family: 'Orbitron', sans-serif; font-size: 20px; font-weight: 700; fill: $CLASS_COLOR; }
.stats-label { font-family: 'Rajdhani', sans-serif; font-size: 11px; font-weight: 600; fill: $SECONDARY; text-transform: uppercase; letter-spacing: 1px; }
.stats-value { font-family: 'Share Tech Mono', monospace; font-size: 14px; font-weight: 700; fill: white; }
.rank-display { font-family: 'Orbitron', sans-serif; font-size: 48px; font-weight: 900; fill: $RANK_COLOR; }
.xp-label { font-family: 'Rajdhani', sans-serif; font-size: 10px; fill: #AAAAAA; text-transform: uppercase; }
.xp-value { font-family: 'Share Tech Mono', monospace; font-size: 11px; fill: #CCCCCC; }
.bio-text { font-family: 'Share Tech Mono', monospace; font-size: 9px; fill: #BBBBBB; line-height: 1.4; }
.project-name { font-family: 'Rajdhani', sans-serif; font-size: 10px; font-weight: 600; fill: white; }
.project-stats { font-family: 'Share Tech Mono', monospace; font-size: 8px; fill: #AAAAAA; }
.skills-text { font-family: 'Rajdhani', sans-serif; font-size: 9px; fill: $ACCENT; }
.attr-label { font-family: 'Rajdhani', sans-serif; font-size: 10px; fill: #888888; }
.attr-value { font-family: 'Orbitron', sans-serif; font-size: 18px; font-weight: 700; fill: white; }
.level-display { font-family: 'Orbitron', sans-serif; font-size: 42px; font-weight: 900; fill: $PRIMARY; }
</style>
EOF
          
          # Gradientes baseados no estilo da barra
          cat >> "$SVG_FILE" << EOF
<linearGradient id="bgGradient" x1="0%" y1="0%" x2="100%" y2="100%">
<stop offset="0%" stop-color="$BACKGROUND"/>
<stop offset="50%" stop-color="#111111"/>
<stop offset="100%" stop-color="$BACKGROUND"/>
</linearGradient>

<linearGradient id="xpBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="$PRIMARY"/>
<stop offset="50%" stop-color="$ACCENT"/>
<stop offset="100%" stop-color="$SECONDARY"/>
</linearGradient>

<linearGradient id="hpBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#FF0000"/>
<stop offset="100%" stop-color="#FF6B6B"/>
</linearGradient>

<linearGradient id="mpBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#00AAFF"/>
<stop offset="100%" stop-color="#00FFFF"/>
</linearGradient>

<linearGradient id="atkBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#FF4500"/>
<stop offset="100%" stop-color="#FFD700"/>
</linearGradient>

<linearGradient id="defBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#228B22"/>
<stop offset="100%" stop-color="#00FF00"/>
</linearGradient>

<linearGradient id="intBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#8A2BE2"/>
<stop offset="100%" stop-color="#9370DB"/>
</linearGradient>

<linearGradient id="spdBarGrad" x1="0%" y1="0%" x2="100%" y2="0%">
<stop offset="0%" stop-color="#FF00FF"/>
<stop offset="100%" stop-color="#FF1493"/>
</linearGradient>

<!-- Padr√µes de fundo -->
<pattern id="gridPattern" width="20" height="20" patternUnits="userSpaceOnUse">
<path d="M 20 0 L 0 0 0 20" fill="none" stroke="$PRIMARY" stroke-width="0.3" opacity="0.1"/>
</pattern>

<pattern id="circuitPattern" width="50" height="50" patternUnits="userSpaceOnUse">
<circle cx="25" cy="25" r="1" fill="$SECONDARY" opacity="0.1"/>
<path d="M25,10 V40 M10,25 H40" stroke="$ACCENT" stroke-width="0.2" opacity="0.05" fill="none"/>
</pattern>

<!-- Filtros de efeito -->
<filter id="neonGlow">
<feGaussianBlur stdDeviation="3" result="blur"/>
<feMerge>
<feMergeNode in="blur"/>
<feMergeNode in="SourceGraphic"/>
</feMerge>
</filter>

<filter id="rankGlow">
<feGaussianBlur stdDeviation="5" result="blur"/>
<feFlood flood-color="$RANK_GLOW" flood-opacity="0.7"/>
<feComposite in2="blur" operator="in"/>
<feMerge>
<feMergeNode in="blur"/>
<feMergeNode in="SourceGraphic"/>
</feMerge>
</filter>
</defs>
EOF
          
          # Estrutura do card
          cat >> "$SVG_FILE" << EOF
<!-- FUNDO -->
<rect width="900" height="500" fill="url(#bgGradient)"/>
<rect width="900" height="500" fill="url(#gridPattern)" opacity="0.05"/>
<rect width="900" height="500" fill="url(#circuitPattern)" opacity="0.03"/>

<!-- CARD PRINCIPAL -->
<rect x="30" y="30" width="840" height="440" rx="20" fill="#111111" opacity="0.95" stroke="$PRIMARY" stroke-width="2"/>

<!-- CABE√áALHO -->
<rect x="30" y="30" width="840" height="80" rx="20" fill="#1A1A1A" opacity="0.9"/>
<text x="450" y="70" text-anchor="middle" class="title-main">$PLAYER_ESC</text>
<text x="450" y="95" text-anchor="middle" class="class-name">[$CLASS] ‚Ä¢ $ALIGNMENT</text>

<!-- COLUNA ESQUERDA - STATUS -->
<g transform="translate(50, 120)">
<!-- AVATAR E N√çVEL -->
<circle cx="60" cy="60" r="50" fill="#222222"/>
<circle cx="60" cy="60" r="48" fill="#1A1A1A"/>
<image href="$AVATAR_URL" x="20" y="20" width="80" height="80" opacity="0.9"/>
<circle cx="60" cy="60" r="50" fill="none" stroke="$CLASS_COLOR" stroke-width="2"/>
<text x="60" y="130" text-anchor="middle" class="level-display">$LEVEL</text>
<text x="60" y="150" text-anchor="middle" class="stats-label">N√çVEL</text>

<!-- RANK -->
<g transform="translate(0, 160)">
<rect x="0" y="0" width="120" height="60" rx="10" fill="#222222"/>
<text x="60" y="25" text-anchor="middle" class="stats-label">RANK METRO</text>
<text x="60" y="55" text-anchor="middle" class="rank-display" filter="url(#rankGlow)">$RANK</text>
</g>

<!-- BARRA DE XP -->
<g transform="translate(0, 240)">
<text x="0" y="0" class="xp-label">EXPERI√äNCIA $XP_PERCENT%</text>
<rect x="0" y="5" width="120" height="12" rx="6" fill="#0A0A0A"/>
<rect x="0" y="5" width="$BAR_XP_WIDTH" height="12" rx="6" fill="url(#xpBarGrad)"/>
<text x="120" y="15" text-anchor="end" class="xp-value">$XP_CURRENT/$XP_NEEDED</text>
</g>
</g>

<!-- COLUNA CENTRAL - ATRIBUTOS -->
<g transform="translate(200, 120)">
<!-- HP E MP -->
<g transform="translate(0, 0)">
<text x="0" y="0" class="stats-label">‚ù§Ô∏è VITALIDADE</text>
<rect x="0" y="5" width="200" height="10" rx="5" fill="#1A1A1A"/>
<rect x="0" y="5" width="$BAR_HP_WIDTH" height="10" rx="5" fill="url(#hpBarGrad)"/>
<text x="200" y="14" text-anchor="end" class="xp-value">$HP/1000</text>

<text x="0" y="35" class="stats-label">üíô ENERGIA</text>
<rect x="0" y="40" width="200" height="10" rx="5" fill="#1A1A1A"/>
<rect x="0" y="40" width="$BAR_MP_WIDTH" height="10" rx="5" fill="url(#mpBarGrad)"/>
<text x="200" y="49" text-anchor="end" class="xp-value">$MP/1000</text>
</g>

<!-- ATRIBUTOS PRINCIPAIS -->
<g transform="translate(0, 80)">
<!-- ATK -->
<rect x="0" y="0" width="95" height="60" rx="8" fill="#222222"/>
<text x="47" y="20" text-anchor="middle" class="attr-label">‚öîÔ∏è ATK</text>
<text x="47" y="45" text-anchor="middle" class="attr-value">$ATK</text>
<rect x="5" y="50" width="85" height="5" rx="2" fill="#1A1A1A"/>
<rect x="5" y="50" width="$BAR_ATK_WIDTH" height="5" rx="2" fill="url(#atkBarGrad)"/>

<!-- DEF -->
<rect x="105" y="0" width="95" height="60" rx="8" fill="#222222"/>
<text x="152" y="20" text-anchor="middle" class="attr-label">üõ°Ô∏è DEF</text>
<text x="152" y="45" text-anchor="middle" class="attr-value">$DEF</text>
<rect x="110" y="50" width="85" height="5" rx="2" fill="#1A1A1A"/>
<rect x="110" y="50" width="$BAR_DEF_WIDTH" height="5" rx="2" fill="url(#defBarGrad)"/>
</g>

<g transform="translate(0, 70)">
<!-- INT -->
<rect x="0" y="70" width="95" height="60" rx="8" fill="#222222"/>
<text x="47" y="90" text-anchor="middle" class="attr-label">üß† INT</text>
<text x="47" y="115" text-anchor="middle" class="attr-value">$INT</text>
<rect x="5" y="120" width="85" height="5" rx="2" fill="#1A1A1A"/>
<rect x="5" y="120" width="$BAR_INT_WIDTH" height="5" rx="2" fill="url(#intBarGrad)"/>

<!-- SPD -->
<rect x="105" y="70" width="95" height="60" rx="8" fill="#222222"/>
<text x="152" y="90" text-anchor="middle" class="attr-label">‚ö° SPD</text>
<text x="152" y="115" text-anchor="middle" class="attr-value">$SPD</text>
<rect x="110" y="120" width="85" height="5" rx="2" fill="#1A1A1A"/>
<rect x="110" y="120" width="$BAR_SPD_WIDTH" height="5" rx="2" fill="url(#spdBarGrad)"/>
</g>

<!-- HABILIDADES -->
<g transform="translate(0, 150)">
<rect x="0" y="0" width="200" height="40" rx="8" fill="#222222"/>
<text x="10" y="15" class="stats-label">üî• HABILIDADES</text>
<text x="10" y="30" class="skills-text">$SKILLS_ESC</text>
</g>

<!-- BIO -->
<g transform="translate(0, 200)">
<rect x="0" y="0" width="200" height="50" rx="8" fill="#222222"/>
<text x="10" y="15" class="stats-label">üì° BIO MATRIX</text>
<text x="10" y="30" class="bio-text" width="180">$BIO_ESC</text>
</g>
</g>

<!-- COLUNA DIREITA - STATS -->
<g transform="translate(420, 120)">
<!-- STATS GITHUB -->
<g transform="translate(0, 0)">
<text x="0" y="0" class="stats-label">üìä STATS GITHUB</text>

<g transform="translate(0, 20)">
<rect x="0" y="0" width="95" height="40" rx="6" fill="#222222"/>
<text x="47" y="15" text-anchor="middle" class="stats-label">Repos</text>
<text x="47" y="32" text-anchor="middle" class="stats-value">$PUBLIC_REPOS</text>

<rect x="105" y="0" width="95" height="40" rx="6" fill="#222222"/>
<text x="152" y="15" text-anchor="middle" class="stats-label">Followers</text>
<text x="152" y="32" text-anchor="middle" class="stats-value">$FOLLOWERS</text>
</g>

<g transform="translate(0, 50)">
<rect x="0" y="0" width="95" height="40" rx="6" fill="#222222"/>
<text x="47" y="15" text-anchor="middle" class="stats-label">Stars</text>
<text x="47" y="32" text-anchor="middle" class="stats-value">$TOTAL_STARS</text>

<rect x="105" y="0" width="95" height="40" rx="6" fill="#222222"/>
<text x="152" y="15" text-anchor="middle" class="stats-label">Forks</text>
<text x="152" y="32" text-anchor="middle" class="stats-value">$TOTAL_FORKS</text>
</g>
</g>

<!-- ATIVIDADE -->
<g transform="translate(0, 120)">
<text x="0" y="0" class="stats-label">‚ö° ATIVIDADE</text>

<g transform="translate(0, 20)">
<rect x="0" y="0" width="65" height="35" rx="5" fill="#222222"/>
<text x="32" y="12" text-anchor="middle" class="stats-label">Commits</text>
<text x="32" y="27" text-anchor="middle" class="stats-value">$COMMITS</text>

<rect x="75" y="0" width="65" height="35" rx="5" fill="#222222"/>
<text x="107" y="12" text-anchor="middle" class="stats-label">PRs</text>
<text x="107" y="27" text-anchor="middle" class="stats-value">$PRS</text>

<rect x="150" y="0" width="65" height="35" rx="5" fill="#222222"/>
<text x="182" y="12" text-anchor="middle" class="stats-label">Issues</text>
<text x="182" y="27" text-anchor="middle" class="stats-value">$ISSUES</text>
</g>
</g>

<!-- PROJETOS TOP -->
<g transform="translate(0, 180)">
<text x="0" y="0" class="stats-label">üöÄ PROJETOS TOP</text>

<g transform="translate(0, 20)">
<!-- Projeto 1 -->
<rect x="0" y="0" width="200" height="35" rx="6" fill="#222222"/>
<text x="10" y="12" class="project-name">$PROJECT1_NAME</text>
<text x="10" y="25" class="project-stats">‚≠ê $PROJECT1_STARS ‚Ä¢ üç¥ $PROJECT1_LANG</text>

<!-- Projeto 2 -->
<rect x="0" y="45" width="200" height="35" rx="6" fill="#222222"/>
<text x="10" y="57" class="project-name">$PROJECT2_NAME</text>
<text x="10" y="70" class="project-stats">‚≠ê $PROJECT2_STARS ‚Ä¢ üç¥ $PROJECT2_LANG</text>

<!-- Projeto 3 -->
<rect x="0" y="90" width="200" height="35" rx="6" fill="#222222"/>
<text x="10" y="102" class="project-name">$PROJECT3_NAME</text>
<text x="10" y="115" class="project-stats">‚≠ê $PROJECT3_STARS ‚Ä¢ üç¥ $PROJECT3_LANG</text>
</g>
</g>
</g>

<!-- RODAP√â -->
<g transform="translate(50, 430)">
<rect x="0" y="0" width="800" height="30" rx="8" fill="#0A0A0A" opacity="0.9"/>
<text x="10" y="20" class="xp-value">‚ö° METRO GOTHIC XP SYSTEM ‚Ä¢ Dificuldade: $DIFFICULTY ‚Ä¢ Tema: ${{ github.event.inputs.theme || 'CYBERPUNK' }} ‚Ä¢ Estilo: $BAR_STYLE</text>
<text x="790" y="20" class="xp-value" text-anchor="end">$MATRIX_DATE $MATRIX_TIME</text>
</g>

<!-- EFEITOS ESPECIAIS -->
<circle cx="100" cy="100" r="2" fill="$ACCENT" opacity="0.6">
<animate attributeName="opacity" values="0.2;0.8;0.2" dur="2s" repeatCount="indefinite"/>
</circle>

<circle cx="800" cy="150" r="2" fill="$PRIMARY" opacity="0.6">
<animate attributeName="opacity" values="0.2;0.8;0.2" dur="2.5s" repeatCount="indefinite"/>
</circle>

<circle cx="200" cy="400" r="2" fill="$SECONDARY" opacity="0.6">
<animate attributeName="opacity" values="0.2;0.8;0.2" dur="3s" repeatCount="indefinite"/>
</circle>

<!-- LINHAS DE SCAN -->
<line x1="30" y1="110" x2="870" y2="110" stroke="$ACCENT" stroke-width="0.5" opacity="0.2">
<animate attributeName="opacity" values="0.1;0.4;0.1" dur="4s" repeatCount="indefinite"/>
</line>

</svg>
EOF
          
          echo "‚úÖ CARD METRO GOTHIC GERADO!"
          echo "üìÅ Arquivo: $SVG_FILE"
          echo "üéÆ Classe: $CLASS"
          echo "üèÜ N√≠vel: $LEVEL | Rank: $RANK"
          echo "üé® Tema: ${{ github.event.inputs.theme || 'CYBERPUNK' }}"
          echo "‚ú® Efeitos: $EFFECTS"
      
      - name: üöÄ IMPLANTAR NA MATRIX
        run: |
          git config user.name "metro-system"
          git config user.email "matrix@github.com"
          
          git add cards/
          
          if git diff --cached --quiet; then
            echo "üì≠ Nenhuma mudan√ßa na Matrix"
          else
            git commit -m "üéÆ METRO CARD: ${{ github.event.inputs.github_user }} | ${{ steps.scan-matrix.outputs.class }} Lv.${{ steps.scan-matrix.outputs.level }}"
            git push
            echo "üöÄ CARD IMPLANTADO NA MATRIX!"
            echo "üåê Acesse em: /cards/ no reposit√≥rio"
          fi
